!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.RPlayer=t()}(this,function(){"use strict";var e=document,t=1,i=!1,s={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""},r={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},o=null,n=null,l="rplayer-hide",a={function:"[object Function]",object:"[object Object]",string:"[object String]",undef:"[object Undefined]"},u=function(e){return function(t){return Object.prototype.toString.call(t)===a[e]}},h=u("function"),c=u("object"),d=u("string"),p=u("undef"),f={handlers:{}};f.hasClass=function(e,t){return!!e&&(e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1)},f.addClass=function(e,t){return e&&!this.hasClass(e,t)&&(e.classList?e.classList.add(t):e.className+=" "+t),this},f.removeClass=function(e,t){var i,s=new RegExp("\\s+"+t+"\\s+");return e&&this.hasClass(e,t)&&(i=" "+e.className+" ",e.classList?e.classList.remove(t):e.className=i.replace(s," ").trim()),this},f.toggleClass=function(e,t){var i,s=new RegExp("\\s+"+t+"\\s+");return e&&(e.classList?e.classList.toggle(t):(t=" "+t+" ",(i=" "+e.className+" ").indexOf(t)>-1?e.className=i.replace(s," ").trim():e.className+=" "+t)),this},f.css=function(e,t,i){var s="";if(p(i)){if(c(t)){for(i in t)s+=i+":"+t[i]+";";e.style.cssText+=s}else if(d(t))return getComputedStyle(e).getPropertyValue(t)}else e.style[t]=i;return this},f.fullScreen=function(t,i){var s=this.fsApi;return s?i?e[s.exitFullscreen]():t[s.requestFullscreen]():this.fullPage(t,i),this},f.fullPage=function(e,t){t?f.removeClass(e,"rplayer-fixed"):f.addClass(e,"rplayer-fixed")},f.selectElement=function(t,i){var s;i=i||e,t&&(t.nodeName||(r=t,r&&r.window===r)?s=t:"string"==typeof t&&(s=/^#[^>~+\[\]\s:]+$/.test(t)?e.getElementById(t.substring(1)):i.querySelector(t)));var r;return s},f.createElement=function(t,i){var s,r=e.createElement(t);if(c(i))for(s in i)r.setAttribute(s,i[s]);return r},f._on=function(e,i,s){var r,o=e.guid;o||(o=t++,Object.defineProperty(e,"guid",{value:o})),(r=this.handlers[o])?r[i]||(r[i]=[]):(r=this.handlers[o]={})[i]=[],r[i].push(s),e.addEventListener(i,s)},f.on=function(e,t,i,s){var r,o,n=this.selectElement(e);if(n)if(t){if(r=(t=t.split(" ")).length,h(i))for(;r--;)o=t[r],s?this._off(n,o,i):this._on(n,o,i);else if(s)for(;r--;)this._off(n,t[r])}else s&&this._off(n);return this},f._off=function(e,t,i){var s,r=e.guid,o=this.handlers[r],n=0;if(o)if(t&&(o=o[t]))if(s=o.length,i){for(;n<s;n++)if(o[n]===i){o.splice(n,1),e.removeEventListener(t,i);break}}else o.forEach(function(i){e.removeEventListener(t,i)}),f.handlers[t]=[];else if(!t)for(n in o)this._off(e,n)},f.off=function(e,t,i){return this.on(e,t,i,!0)},f.once=function(e,t,i){var s,r=this;return h(i)&&(s=function(){var o=Array.prototype.slice.call(arguments);i.apply(this,o),r.off(e,t,s)},this.on(e,t,s)),this},f.fsApi=function(){for(var e,t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=null,r=i[0],o=0,n=i.length;o<n;o++)if((e=i[o])[1]in document){t=!0;break}return t&&(s={},e.forEach(function(e,t){s[r[t]]=e})),s}();function m(e){this.config=e}m.prototype={constructor:m,setVolume:function(e){return e>1&&(e/=100),e>1&&(e=1),this.el.volume=e,this.el.muted=!e,this},getVolume:function(){return Math.floor(100*this.el.volume)},mute:function(e){return this.el.muted=!!e,this},isMuted:function(){return this.el.muted},autoPlay:function(e){return this.el.autoplay=!!e,this},isAutoPlay:function(){return this.el.autoplay},play:function(e){return e?this.el.play():this.el.pause(),this},isPaused:function(){return this.el.paused},isError:function(){var e=this.el.error;return e?e.code:e},loop:function(e){return this.el.loop=!!e,this},isLoop:function(){return this.el.loop},setPoster:function(e){return this.el.poster=e,this},setPreload:function(e){return this.el.preload=e,this},setCurrentTime:function(e,t){var i=this.getDuration();return t&&(e*=i),this.el.currentTime=e,this},getCurrentTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration},getPlayedPercentage:function(){return this.getCurrentTime()/this.getDuration()},getBuffered:function(e){var t=this.el.buffered,i=t.length;return e&&i&&(t=t.end(i-1)/this.getDuration()*100),t},getReadyState:function(){return this.el.readyState},showControls:function(){return this.el.controls=!0,this},convertTime:function(e){var t,i,s,r,o=function(e){return e<10?"0"+e:e.toString()};return(e=Math.ceil(e))<=0?t="00:00":e<60?t="00:"+o(e):e<3600?(r=e%60,t=o(s=Math.floor(e/60))+":"+o(r)):(i=Math.floor(e/3600),t=e%3600,s=Math.floor(t/60),r=t%60,t=o(i)+":"+o(s)+":"+o(r)),t},reload:function(){return this.el.load(),this},changeSource:function(e){var t=this.isPaused();return console.log(this.source,e),this.source!==e&&(this.source=e,this.initSource(e)),t||this.play(!0),this},getSource:function(){return this.el.currentSrc},initSource:function(t){var i=e.createDocumentFragment();return"string"==typeof t?this.el.src=t:Array.isArray(t)&&(this.el.innerHTML="",t.forEach(function(e){var t=f.createElement("source",{src:e});i.appendChild(t)}),this.el.appendChild(i)),this},init:function(){var t=f.createElement("video"),i=e.createTextNode(this.config.msg.toString());return this.el=t,this.source=this.config.source,t.appendChild(i),f.addClass(this.el,"rplayer-video"),this.initSource(this.source).autoPlay(this.config.autoPlay).loop(this.config.loop).setPoster(this.config.poster).setPreload(this.config.preload).setVolume(this.config.defaultVolume),this.el}};function v(){this.handlers={}}v.prototype={constructor:v,on:function(e,t){return h(t)&&(d(e)||(e=String(e)),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)),this},off:function(e,t){var i,s=this.handlers[e];if(s)if(h(t)){for(i=s.length;i--;)if(s[i]===t){s.splice(i,1);break}}else t||(this.handlers[e]=[]);return this},once:function(e,t){if(h(t)){var i=this,s=function(){t.apply(this,arguments),i.off(e,s)};this.on(e,s)}},trigger:function(e){var t,i,s=Array.prototype.slice.call(arguments,1),r=this.handlers[e];if(r)for((t=new function(e){this.type=e,this.data=null,this.timeStamp=0}(e)).data=s,t.timeStamp=Date.now(),s=[t].concat(s),i=r.length;i--;)r[i].apply(this,s);return this}};function g(e,t){v.call(this),this.vertical=!p(t)&&!!t,this.el=e,this.distance=this.pos=null,this.moving=!1}var y=g.prototype=Object.create(v.prototype);y.constructor=g,y.getPosition=function(){var e=this.el.parentNode.getBoundingClientRect(),t=this.el;return{width:t.offsetWidth,height:t.offsetHeight,origLeft:t.offsetLeft,origTop:t.offsetTop,maxX:e.width,maxY:e.height}},y.setPosition=function(e,t,i){return i&&(t=100*t+"%"),f.css(this.el,e,t),this},y.mouseDown=function(t){var i=t.clientX,s=t.clientY,r=this.getPosition();this.pos={width:r.width,height:r.height,offsetX:i-r.origLeft,offsetY:s-r.origTop,maxX:r.maxX,maxY:r.maxY},t.stopImmediatePropagation(),f.addClass(this.el,"rplayer-moving").on(e,"mousemove",this.mouseMove.bind(this)).on(e,"mouseup",this.mouseUp.bind(this))},y.mouseMove=function(e){var t,i=e.clientX,s=e.clientY;this.moving=!0,this.vertical?(t=(t=this.pos.maxY-(s-this.pos.offsetY)-this.pos.height)<0?0:t>this.pos.maxY?this.pos.maxY:t,t/=this.pos.maxY,this.setPosition("bottom",t,!0)):(t=(t=i-this.pos.offsetX)<0?0:t>this.pos.maxX?this.pos.maxX:t,t/=this.pos.maxX,this.setPosition("left",t,!0)),this.trigger("slider.moving",this.distance=t)},y.mouseUp=function(){f.off(e,"mousemove moseup").removeClass(this.el,"rplayer-moving"),this.moving&&this.trigger("slider.move.done",this.distance)},y.init=function(){var e=this.el;f.on(e,"mousedown",this.mouseDown.bind(this))};function P(e,t){var i,r=f.selectElement(e);if(v.call(this),(i=c(t)?{autoPlay:!!t.autoPlay,defaultVolume:Math.abs(parseInt(t.defaultVolume))||s.defaultVolume,loop:!!t.loop,msg:t.msg||s.msg,poster:t.poster||s.poster,preload:t.preload||s.preload,source:t.source}:s).source||new Error("没有设置视频链接"),!r)throw new Error("未选中任何元素");this.target=r,this.playedTime=0,this.controlsDisabled=!1,this.video=new m(i),this.controls=!!p(t.controls)||!!t.controls,this.useNativeControls=!p(t.useNativeControls)&&t.useNativeControls}var E=P.prototype=Object.create(v.prototype);return E.constructor=P,E.toggleFullScreen=function(){(this.isFullScreen=!this.isFullScreen)?this.requestFullScreen():this.exitFullScreen()},E.requestFullScreen=function(){this.isFullScreen=!0,f.fullScreen(this.container).addClass(this.fullScreenBtn,"rplayer-fullscreen").addClass(this.container,"rplayer-fullscreen")},E.exitFullScreen=function(){this.isFullScreen=!1,f.fullScreen(this.container,!0).removeClass(this.fullScreenBtn,"rplayer-fullscreen").removeClass(this.container,"rplayer-fullscreen")},E.initFullScreenEvent=function(){var t=this,i=f.fsApi;return i&&f.on(e,i.fullscreenchange,function(){e[i.fullscreenElement]||t.exitFullScreen()}).on(e,i.fullscreenerror,function(){t.exitFullScreen()}),this},E.updateVolume=function(e,t){return t&&(e*=100),e=Math.floor(e),this.video.setVolume(e),this.updateVolumeStyle(e),this},E.mute=function(){var e=this.video.getVolume();this.video.isMuted()?this.video.mute(!1):(this.video.mute(!0),e=0),this.updateVolumeStyle(e),this.volumeSlider.setPosition("bottom",e+"%")},E.updateVolumeByStep=function(e){var t=this.video.getVolume();t=(t+=e)>100?100:t<0?0:t,this.updateVolume(t),this.toggleVolumePopupInfo(t)},E.updateVolumeStyle=function(e){var t=this.showVolumePopBtn.className;return t=t.replace(/volume-[^\s]*/,""),t+=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.volumeValue.style.height=e+"%",this.showVolumePopBtn.className=this.muteBtn.className=t,this.currentVolume.innerHTML=e,this},E.toggleVolumeSettingsPanel=function(e){this.controlsDisabled||f.toggleClass(this.volumePopup,l),e.stopPropagation()},E.hideVolumeSettingsPanel=function(){return f.addClass(this.volumePopup,l),this},E.clickOnBar=function(e,t){i?i=!1:t.call(this,e)},E.clickVolumeTrack=function(e){if(this.volumeSlider.moving)this.volumeSlider.moving=!1;else{var t=this.volumeProgress.getBoundingClientRect(),i=e.clientY;t=(t.height-i+t.top)/t.height,this.updateVolume(t,!0),this.volumeSlider.setPosition("bottom",t,!0)}},E.initVolumeEvent=function(){var t=this;return f.on(this.volumePopup,"mouseleave",this.hideVolumeSettingsPanel.bind(this)).on(this.volumeProgress,"click",this.clickVolumeTrack.bind(this)).on(e,"click",function(e){var i=e.target;i===t.volumePopup||t.volumePopup.contains(i)||t.hideVolumeSettingsPanel()}),this},E.togglePlay=function(){this.controlsDisabled||(this.video.isPaused()?this.play():this.pause())},E.play=function(){return f.addClass(this.playBtn,"paused"),this.video.play(!0),this},E.pause=function(){return this.video.play(!1),f.removeClass(this.playBtn,"paused"),this},E.showPopupTimeInfo=function(e){var t=this.video.getDuration(),i=this.videoPopupTime,s=this.mark;if(t){f.removeClass(i,l).removeClass(s,l);var r=this.videoTrack.getBoundingClientRect(),o=e.clientX-r.left,n=i.offsetWidth,a=o-n/2,u=r.width-n;a=a<0?0:a>u?u:a,u=o/r.width,i.innerHTML=this.video.convertTime(u*t),i.style.left=a+"px",s.style.left=100*u+"%"}return this},E.hidePopupTimeInfo=function(){return f.addClass(this.videoPopupTime,l).addClass(this.mark,l),this},E.showLoading=function(){return f.removeClass(this.loading,l),this},E.hideLoading=function(){return f.addClass(this.loading,l),this},E.progress=function(){var e=this.video.getBuffered(!0);"number"==typeof e&&this.bufferedBar&&(this.bufferedBar.style.width=e+"%"),this.video.getReadyState()<3&&this.showLoading()},E.updateProgressPosition=function(e){return p(e)&&(e=this.video.getPlayedPercentage()),this.videoProgress.style.width=100*e+"%",this.updateCurrentTime(),this},E.updateProgressByStep=function(e){var t=this.video.getCurrentTime(),i=this.video.getDuration();t=(t+=e)<0?0:t>i?i:t,this.video.setCurrentTime(t),this.updateProgressPosition()},E.updateCurrentTime=function(){return this.currentTime.innerHTML=this.video.convertTime(this.video.getCurrentTime()),this},E.updateTotalTime=function(){return this.totalTime.innerHTML=this.video.convertTime(this.video.getDuration()),this},E.updateMetaInfo=function(){this.video.isAutoPlay()&&this.play(),this.updateTotalTime().enableControls()},E.hideControls=function(){return f.addClass(this.controlsPanel,l),this},E.showControls=function(){var e=this;if(null==this.video.isError())return clearTimeout(n),f.removeClass(this.controlsPanel,l),f.hasClass(this.volumePopup,l)&&(n=setTimeout(function(){e.hideControls()},5e3)),this},E.enableControls=function(){return f.removeClass(this.controlsPanel,"rplayer-disabled"),this.controlsDisabled=!1,this},E.disableControls=function(){return f.addClass(this.controlsPanel,"rplayer-disabled"),this.controlsDisabled=!0,this},E.loop=function(){return this.video.isLoop()?this.play():this.pause()},E.toggleError=function(){var e=this.errorMsg.parentNode;return f.toggleClass(e,l),this.hideLoading().hideControls(),this},E.error=function(){var e,t=this.video.isError(),i=this.video.getCurrentTime();switch(i&&(this.playedTime=i),t=r[t]){case"MEDIA_ERR_ABORTED":e="出错了";break;case"MEDIA_ERR_NETWORK":e="网络错误或视频地址无效";break;case"MEDIA_ERR_DECODE":case"MEDIA_ERR_SRC_NOT_SUPPORTED":e="解码失败,不支持的视频格式或地址无效"}e+=",点击刷新",this.errorMsg.innerHTML=e,this.toggleError()},E.refresh=function(){this.video.reload(),this.toggleError()},E.initPlayEvent=function(){var e=this,t=this.video.el;return f.on(t,"loadstart stalled",function(t){e.playedTime&&"loadstart"===t.type&&(e.video.setCurrentTime(e.playedTime),this.playedTime=0),e.showLoading().disableControls()}).on(t,"progress",this.progress.bind(this)).on(t,"canplay seeked",this.hideLoading.bind(this)).on(t,"ended",this.loop.bind(this)).on(t,"error",this.error.bind(this)).on(t,"contextmenu",function(e){e.preventDefault()}),this},E.toggleVolumePopupInfo=function(e){var t=this;return f.hasClass(this.volumePopup,l)&&(clearTimeout(o),this.volumePopupInfo.innerHTML="当前音量: "+e,this.currentVolume.innerHTML=e,f.removeClass(this.volumePopupInfo,l),o=setTimeout(function(){f.addClass(t.volumePopupInfo,l)},3e3)),this},E.keyDown=function(e){if(!this.controlsDisabled){var t=e.key.toLowerCase(),i={up:5,arrowup:5,down:-5,arrowdown:-5,left:-10,arrowleft:-10,right:10,arrowright:10,esc:"esc",escape:"escape"}[t];i?/(left)|(right)/.test(t)?this.updateProgressByStep(i):/(up)|(down)/.test(t)?this.updateVolumeByStep(i):this.toggleFullScreen():" "!==t&&"spacebar"!==t||this.togglePlay(),e.preventDefault()}},E.handleClick=function(e){switch(e.target){case this.showVolumePopBtn:this.toggleVolumeSettingsPanel(e);break;case this.muteBtn:this.mute();break;case this.playBtn:case this.video.el:this.togglePlay();break;case this.fullScreenBtn:this.toggleFullScreen();break;case this.errorMsg:this.refresh()}},E.initEvent=function(){return f.on(this.container,"click",this.handleClick.bind(this)),this.initPlayEvent(),this},E.clickVideoTrack=function(e){if(this.videoSlider.moving)this.videoSlider.moving=!1;else{var t=this.videoTrack.getBoundingClientRect();t=(e.clientX-t.left)/t.width,this.video.setCurrentTime(t,!0),this.updateProgressPosition(t),this.videoSlider.setPosition("left",t,!0)}},E.initControlEvent=function(){var e=this,t=this.video.el;return this.videoSlider.on("slider.move.done",function(t,i){e.video.setCurrentTime(i),e.updateProgressPosition(i)}).on("slider.moving",function(t,i){e.updateProgressPosition(i)}),this.volumeSlider.on("slider.moving",function(t,i){e.updateVolume(i,!0),console.log(i)}),this.videoSlider.init(),this.volumeSlider.init(),f.on(this.videoTrack,"mouseover mousemove",this.showPopupTimeInfo.bind(this)).on(this.videoTrack,"mouseout",this.hidePopupTimeInfo.bind(this)).on(this.videoTrack,"click",this.clickVideoTrack.bind(this)).on(this.container,"keydown",this.keyDown.bind(this)).on(this.container,"mousemove",this.showControls.bind(this)).on(t,"loadedmetadata",this.updateMetaInfo.bind(this)).on(t,"timeupdate",function(){var t=e.video.getPlayedPercentage();e.videoSlider.moving?e.updateCurrentTime():(e.updateProgressPosition(t),e.videoSlider.setPosition("left",t,!0))}).on(t,"dblclick",this.toggleFullScreen.bind(this)).on(t,"seeking",this.showLoading.bind(this)),this.initVolumeEvent().initFullScreenEvent()},E.offEvent=function(){return f.off(e).off(this.volumePopup).off(this.volumeProgress).off(this.videoTrack).off(this.container).off(this.video.el),this},E.removeProp=function(){var e;for(e in this)delete this[e];return this},E.destroy=function(){return this.container&&this.offEvent().removeProp(),this},E.initEssentialElements=function(){var e=this.container;return this.loading=f.selectElement(".rplayer-loading",e),this.errorMsg=f.selectElement(".rplayer-msg",e),this},E.initElements=function(){var e=this.container,t=f.selectElement(".rplayer-volume-slider",e),i=f.selectElement(".rplayer-video-slider",e);return this.volumeSlider=new g(t,!0),this.videoSlider=new g(i),this.playBtn=f.selectElement(".rplayer-play-btn",e),this.videoTrack=f.selectElement(".rplayer-video-track",e),this.videoProgress=f.selectElement(".rplayer-video-progress",e),this.videoPopupTime=f.selectElement(".rplayer-popup-video-info",e),this.currentTime=f.selectElement(".rplayer-current-time",e),this.totalTime=f.selectElement(".rplayer-total-time",e),this.bufferedBar=f.selectElement(".rplayer-bufferd-bar",e),this.showVolumePopBtn=f.selectElement(".rplayer-audio-btn",e),this.muteBtn=f.selectElement(".rplayer-mute",e),this.volumePopup=f.selectElement(".rplayer-volume-popup",e),this.volumePopupInfo=f.selectElement(".rplayer-popup-volume-info",e),this.volumeProgress=f.selectElement(".rplayer-volume-progress",e),this.volumeValue=f.selectElement(".rplayer-volume-value",e),this.currentVolume=f.selectElement(".rplayer-current-volume",e),this.fullScreenBtn=f.selectElement(".rplayer-fullscreen-btn",e),this.mark=f.selectElement(".rplayer-mark",e),this},E.getSource=function(){return this.video.getSource()},E.initialize=function(){if(!this.container){var t=f.createElement("div",{tabIndex:100}),i=parseInt(getComputedStyle(this.target).height);this.isFullScreen=!1,t.innerHTML='<div class="rplayer-loading rplayer-hide"></div><div class="rplayer-popup-info rplayer-popup-volume-info rplayer-hide">10:00</div><div class="rplayer-error rplayer-hide"><div class="rplayer-msg">出错了</div></div>',t.style.height=(i||500)+"px",this.container=t,t.appendChild(this.video.init()),f.addClass(this.container,"rplayer-container"),this.controls&&!this.useNativeControls?(this.controlsPanel=e.createElement("div"),f.addClass(this.controlsPanel,"rplayer-controls"),this.controlsPanel.innerHTML='<div class="rplayer-popup-info rplayer-popup-video-info rplayer-hide">10:00</div>        <div class="rplayer-progress-panel">            <div class="rplayer-progress rplayer-video-track">                <div class="rplayer-bufferd-bar"></div>                <div class="rplayer-bar rplayer-video-progress"></div>                <div class="rplayer-mark rplayer-hide"></div>                <div class="rplayer-slider rplayer-video-slider"></div>            </div>        </div>        <div class="rplayer-play-control rplayer-lf">            <button type="button" class="rplayer-play-btn"></button>            <span class="rplayer-time-info">               <span class="rplayer-current-time">00:00</span>/               <span class="rplayer-total-time">00:00</span>             </span>        </div>        <div class="rplayer-settings rplayer-rt">            <button type="button" class="rplayer-fullscreen-btn rplayer-rt"></button>            <div class="rplayer-audio-control rplayer-rt">                <button type="button" class="rplayer-audio-btn volume-1"></button>                <div class="rplayer-volume-popup rplayer-hide">                    <span class="rplayer-current-volume">12</span>                    <div class="rplayer-progress rplayer-volume-progress">                        <div class="rplayer-bar rplayer-volume-value"></div>                        <div class="rplayer-slider rplayer-volume-slider"></div>                    </div>                    <button class="rplayer-mute volume-1"></button>                </div>            </div>        </div>',this.container.appendChild(this.controlsPanel),this.initElements().updateVolumeStyle(this.video.getVolume()).initControlEvent()):this.useNativeControls&&this.video.showControls(),this.target.appendChild(this.container),this.initEssentialElements().initEvent()}return this},E.updateSource=function(e){this.video.changeSource(e)},P.init=function(e,t){return new P(e,t).initialize()},P});