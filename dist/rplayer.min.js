!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.RPlayer=t()}(this,function(){"use strict";var e={handlers:{}},t=document,i=1;function n(e){return"[object Function]"===Object.prototype.toString.call(e)}e.hasClass=function(e,t){return e.classList?e.classList.contains(t):new RegExp(t).test(e.className)},e.addClass=function(e,t){return this.hasClass(e,t)||(e.classList?e.classList.add(t):e.className+=" "+t),this},e.removeClass=function(e,t){var i=new RegExp("\\s*"+t+"\\s*");return this.hasClass(e,t)&&(e.classList?e.classList.remove(t):e.className=e.className.replace(i," ").trim()),this},e.fullScreen=function(e,i){var n=this.fsApi;return n?i?t[n.exitFullscreen]():e[n.requestFullscreen]():this.fullPage(e,i),this},e.fullPage=function(t,i){i?e.removeClass(t,"fixed"):e.addClass(t,"fixed")},e.selectElement=function(e,i){var n;return i=i||t,e&&(e.nodeName?n=e:"string"==typeof e&&(/^#[^>~+\[\]\s]+$/.test(e)?(n=t.getElementById(e.substring(1)),console.log(e,n)):n=i.querySelector(e))),n},e._on=function(e,t,n){var r,o=e.guid;o||(o=i++,Object.defineProperty(e,"guid",{value:o})),(r=this.handlers[o])?r[t]||(r[t]=[]):(r=this.handlers[o]={})[t]=[],r[t].push(n),e.addEventListener(t,n)},e.on=function(e,t,i,r){var o,l,s=this.selectElement(e);if(s)if(o=(t=t.split(" ")).length,n(i))for(;o--;)l=t[o],r?this._off(s,l,i):this._on(s,l,i);else this._off(s,t);return this},e._off=function(t,i,n){var r,o=t.guid,l=e.handlers[o],s=0;if(l&&(l=l[i]))if(r=l.length,n){for(;s<r;s++)if(l[s]===n){l.splice(s,1),t.removeEventListener(i,n);break}}else l.forEach(function(e){t.removeEventListener(i,e)}),e.handlers[i]=[]},e.off=function(e,t,i){return this.on(e,t,i,!0)},e.once=function(e,t,i){var r,o=this;n(i)&&(r=function(){var n=Array.prototype.slice.call(arguments);i.apply(this,n),o.off(e,t,r)},this.on(e,t,r))};e.fsApi=function(){for(var e,t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=null,r=i[0],o=0,l=i.length;o<l;o++)if((e=i[o])[1]in document){t=!0;break}return t&&(n={},e.forEach(function(e,t){n[r[t]]=e})),n}();function r(e){this.config=e}r.prototype={constructor:r,setVolume:function(e){return e>1&&(e/=100),this.el.volume=e,this.el.muted=!e,console.log(e),this},getVolume:function(){return Math.floor(100*this.el.volume)},mute:function(){return this.el.muted=!0,this},unMute:function(){return this.el.muted=!1,this},isMuted:function(){return this.el.muted},play:function(){return this.el.play(),this},pause:function(){return this.el.pause(),this},isPaused:function(){return this.el.paused},setCurrentTime:function(e,t){var i=this.getDuration();return t&&(e*=i),this.el.currentTime=e,this},getCurrentTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration},getPlayedPercentage:function(){return this.getCurrentTime()/this.getDuration()},getBuffered:function(){return this.el.buffered},getReadyState:function(){return this.el.readyState},convertTime:function(e){var t,i,n,r,o=function(e){return e<10?"0"+e:e.toString()};return(e=Math.ceil(e))<=0?t="00:00":e<60?t="00:"+o(e):e<3600?(r=e%60,t=o(n=Math.floor(e/60))+":"+o(r)):(i=Math.floor(e/3600),t=e%3600,n=Math.floor(t/60),r=t%60,t=o(i)+":"+o(n)+":"+o(r)),t},reload:function(){return this.el.load(),this},changeSource:function(e){var t=this.isPaused();return this.source!==e&&(this.source=e,this.initSource()),t||this.play(),this},initSource:function(){var e=this.config.source,i=t.createDocumentFragment();return"string"==typeof e?this.el.src=e:Array.isArray(e)&&(this.el.innerHTML="",e.forEach(function(e){var n=t.createElement("source");n.src=e,i.appendChild(n)}),this.el.appendChild(i)),this},initEvent:function(){l.forEach(function(e){})},init:function(){var i=t.createElement("video");return this.el=i,i.appendChild(t.createTextNode(this.config.msg.toString())),e.addClass(this.el,"rplayer-video"),this.initSource().setVolume(this.config.defaultVolume),this.el}};var o={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""},l=["canplay","loadedmetadata","progress","timeupdate","abort","error","seeking","seeked","ended"];function s(t,i){var n,l=e.selectElement(t);s=i;var s;if((n="[object Object]"===Object.prototype.toString.call(s)?{autoPlay:!!i.autoPlay,defaultVolume:Math.abs(parseInt(i.defaultVolume))||o.defaultVolume,loop:!!i.loop,poster:i.poster||o.poster,source:i.source,msg:i.msg||o.msg}:o).source||new Error("没有设置视频链接"),!l)throw new Error("未选中任何元素");this.target=l,this.isFullScreen=!1,this.video=new r(n),this.timer=null}var u=s.prototype;return u.toggleFullScreen=function(){(this.isFullScreen=!this.isFullScreen)?this.requestFullScreen():this.exitFullScreen()},u.requestFullScreen=function(){this.isFullScreen=!0,e.fullScreen(this.container).addClass(this.fullScreenBtn,"fullscreen").addClass(this.container,"fullscreen")},u.exitFullScreen=function(){this.isFullScreen=!1,e.fullScreen(this.container,!0).removeClass(this.fullScreenBtn,"fullscreen").removeClass(this.container,"fullscreen")},u.initFullScreenEvent=function(){var i=this,n=e.fsApi;return n&&e.on(t,n.fullscreenchange,function(){t[n.fullscreenElement]||i.exitFullScreen()}).on(t,n.fullscreenerror,function(){i.exitFullScreen()}),e.on(this.fullScreenBtn,"click",function(){i.toggleFullScreen()}),this},u.changeVolume=function(e){return e=Math.floor(e),this.video.setVolume(e),this.changeVolumeStyle(e),this},u.changeVolumeStyle=function(e){var t=this.showVolumePopBtn.className;return t=t.replace(/volume-[^\s]*/,""),t+=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.volumeSlider.style.bottom=this.volumeValue.style.height=e+"%",this.showVolumePopBtn.className=this.muteBtn.className=t,this.currentVolume.innerHTML=Math.ceil(e),this},u.toggleVolumeSettingsPanel=function(t){var i="rplayer-hide";e.hasClass(this.volumePopup)&&e.addClass(this.volumePopup,i),e.hasClass(this.volumePopup,i)?e.removeClass(this.volumePopup,i):e.addClass(this.volumePopup,i),t.stopPropagation()},u.slideVolumeSlider=function(i){if(!i.button){var n=this.volumeSlider.offsetTop+12,r=i.clientY,o=this.volumeValue.parentNode.offsetHeight,l=this;e.on(l.container,"mousemove",function(e){var t=e.clientY,i=o-(t-r+n);i=(i=i<0?0:i>o?o:i)/o*100,l.changeVolume(i)}).on(t,"mouseup",function(){e.off(l.container,"mousemove").off(t,"mouseup")})}},u.initVolumeEvent=function(){var t=this;return e.on(this.showVolumePopBtn,"click",this.toggleVolumeSettingsPanel.bind(this)).on(this.volumeSlider,"mousedown",this.slideVolumeSlider.bind(this)).on(this.volumeProgress,"click",function(e){var i=this.getBoundingClientRect(),n=e.clientY;e.target!==t.volumeSlider&&(i=(i.height-n+i.top)/i.height*100,t.changeVolume(i))}).on(t.muteBtn,"click",function(){t.video.isMuted()?(t.video.mute(),t.changeVolumeStyle(0)):(t.video.unMute(),t.changeVolumeStyle(t.video.getVolume()))}),this},u.togglePlay=function(t){this.video.isPaused()?(e.addClass(t,"paused"),this.video.play()):(this.video.pause(),e.removeClass(t,"paused"))},u.showPopupTimeInfo=function(t,i,n){if(this.video.getDuration()){var r=i.getBoundingClientRect(),o=t.clientX-r.left,l=n.offsetWidth,s=o-l/2,u=r.width-l;s=s<0?0:s>u?u:s,n.innerHTML=this.video.convertTime(o/r.width*devicePixelRatio),n.style.left=s+"px",e.removeClass(n,"rplayer-hide")}},u.slideVideoSlider=function(i){if(!i.button){var n,r=this.offsetLeft,o=i.clientX,l=this.videoProgress.parentNode.offsetWidth,s=this,u=this.video.isPaused();e.on(s.container,"mousemove",function(e){var t=e.clientX;n=(n=t-o+r)<0?0:n>l?l:n,n/=l,s.videoProgress.style.width=s.videoSlider.style.left=100*n+"%",s.video.pause()}).on(t,"mouseup",function(){e.off(s.container,"mousemove").off(t,"mouseup"),s.video.setCurrentTime(n,!0),u||s.video.play()})}},u.showLoading=function(){e.addClass(this.loading,"loading").removeClass(this.loading,"rplayer-hide")},u.hideLoading=function(){e.removeClass(this.loading,"loading").addClass(this.loading,"rplayer-hide")},u.progress=function(){var e=this.video.getBuffered(),t=e.length;t&t<100&&(t=(t=e.end(t-1))/this.video.getDuration()*100,this.bufferedBar.style.width=t+"%"),this.video.getReadyState()<3&&this.showLoading()},u.initPlayEvent=function(){var t=this,i=this.video.el;return e.on(this.playBtn,"click",function(){t.togglePlay(this)}).on(this.videoTrack,"click",function(e){var i=this.getBoundingClientRect(),n=e.clientX;e.target!==t.videoSlider&&(i=(n-i.left)/i.width,t.video.setCurrentTime(i,!0),t.videoProgress.style.width=t.videoSlider.style.left=100*i+"%")}).on(this.videoTrack,"mouseover mousemove",function(e){t.showPopupTimeInfo(e,this,t.videoPopupTime)}).on(this.videoTrack,"mouseout",function(){e.addClass(t.videoPopupTime,"rplayer-hide")}).on(this.videoSlider,"mousedown",this.slideVideoSlider.bind(this)).on(i,"loadedmetadata",function(){t.totalTime.innerHTML=t.video.convertTime(t.video.getDuration())}).on(i,"canplay seeked",function(){t.hideLoading()}).on(i,"progress",this.progress.bind(this)).on(i,"timeupdate",function(){var e=this.currentTime/this.duration*100;t.videoProgress.style.width=t.videoSlider.style.left=e+"%",t.currentTime.innerHTML=t.video.convertTime(t.video.getCurrentTime())}).on(i,"abort",function(){}).on(i,"error",function(){console.log("error")}).on(i,"seeking",function(){t.showLoading()}).on(i,"ended",function(){t.togglePlay(t.playBtn),console.log("end")}).on(i,"click",function(){t.togglePlay(t.playBtn)}),this},u.toggleVolumePopupInfo=function(t){var i=this;e.hasClass(this.volumePopup,"rplayer-hide")&&(clearTimeout(this.timer),this.volumePopupInfo.innerHTML=this.currentVolume.innerHTML=t,e.removeClass(this.volumePopupInfo,"rplayer-hide"),this.timer=setTimeout(function(){e.addClass(i.volumePopupInfo,"rplayer-hide")},3e3))},u.keyDown=function(e){var t=e.key.toLowerCase(),i=this.video.getVolume(),n={up:5,arrowup:5,down:-5,arrowdown:-5,left:-5,arrowleft:-5,right:5,arrowright:5,esc:"esc",escape:"escape"}[t];n&&(e.preventDefault(),i+=n,console.log(i),i=i>100?100:i<0?0:i,this.changeVolume(i),this.toggleVolumePopupInfo(i))},u.initEvent=function(){var i=this;return e.on(t,"click",function(t){var n=t.target;i.volumePopup===n||i.volumePopup.contains(n)||e.addClass(i.volumePopup,"rplayer-hide")}).on(this.container,"keydown",this.keyDown.bind(this)),this.initPlayEvent().initVolumeEvent().initFullScreenEvent()},u.destroy=function(){return this.container&&(this.target.removeChild(this.container),this.container=null),this},u.initElements=function(){var t=this.container;return this.playBtn=e.selectElement(".rplayer-play-btn",t),this.videoTrack=e.selectElement(".rplayer-video-track",t),this.videoSlider=e.selectElement(".rplayer-video-slider",t),this.videoProgress=e.selectElement(".rplayer-video-progress",t),this.videoPopupTime=e.selectElement(".rplayer-video-popup-info",t),this.currentTime=e.selectElement(".rplayer-current-time",t),this.totalTime=e.selectElement(".rplayer-total-time",t),this.loading=e.selectElement(".rplayer-loading",t),this.bufferedBar=e.selectElement(".rplayer-bufferd-bar",t),this.showVolumePopBtn=e.selectElement(".rplayer-audio-btn",t),this.muteBtn=e.selectElement(".rplayer-mute",t),this.volumePopup=e.selectElement(".rplayer-volume-popup",t),this.volumePopupInfo=e.selectElement(".rplayer-popup-volume-info",t),this.volumeSlider=e.selectElement(".rplayer-volume-slider",t),this.volumeProgress=e.selectElement(".rplayer-volume-progress",t),this.volumeValue=e.selectElement(".rplayer-volume-value",t),this.currentVolume=e.selectElement(".rplayer-current-volume",t),this.fullScreenBtn=e.selectElement(".rplayer-fullscreen-btn",this.container),this},u.initPlayState=function(){},u.initialize=function(){return this.destroy(),this.container=t.createElement("div"),this.container.tabIndex=100,this.container.innerHTML='<div class="rplayer-loading rplayer-hide"></div>    <div class="rplayer-controls">        <div class="rplayer-popup-info rplayer-video-popup-info rplayer-hide">10:00</div>        <div class="rplayer-progress-panel">            <div class="rplayer-progress rplayer-video-track">                <div class="rplayer-bufferd-bar"></div>                <div class="rplayer-progress-track">                    <div class="rplayer-bar rplayer-video-progress"></div>                    <div class="rplayer-slider rplayer-video-slider"></div>                </div>            </div>        </div>        <div class="rplayer-play-control rplayer-lf">            <button type="button" class="rplayer-play-btn"></button>            <span class="rplayer-time-info">                        <span class="rplayer-current-time">00:00</span>/                        <span class="rplayer-total-time">00:00</span>                    </span>        </div>        <div class="rplayer-settings rplayer-rt">            <button type="button" class="rplayer-fullscreen-btn rplayer-rt"></button>            <div class="rplayer-audio-control rplayer-rt">                <div class="rplayer-popup-info rplayer-popup-volume-info rplayer-hide">10:00</div>                <button type="button" class="rplayer-audio-btn volume-1"></button>                <div class="rplayer-volume-popup rplayer-hide">                    <span class="rplayer-current-volume">12</span>                    <div class="rplayer-progress rplayer-volume-progress">                        <div class="rplayer-audio-track">                            <div class="rplayer-bar rplayer-volume-value"></div>                            <div class="rplayer-slider rplayer-volume-slider"></div>                        </div>                    </div>                    <button class="rplayer-mute volume-1"></button>                </div>            </div>        </div>    </div>',e.addClass(this.container,"rplayer-container"),this.container.appendChild(this.video.init()),this.target.appendChild(this.container),this.initElements().initEvent().changeVolume(this.video.config.defaultVolume),this},s.init=function(e,t){return new s(e,t).initialize()},s});