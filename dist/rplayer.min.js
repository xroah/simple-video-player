!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.RPlayer=t()}(this,function(){"use strict";var e=document,t=1,i={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""},s={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},o=null,r=null,n="rplayer-hide";function l(e){return"[object Function]"===Object.prototype.toString.call(e)}function u(e){return void 0===e}var a={handlers:{}};a.hasClass=function(e,t){return!!e&&(e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1)},a.addClass=function(e,t){return e&&!this.hasClass(e,t)&&(e.classList?e.classList.add(t):e.className+=" "+t),this},a.removeClass=function(e,t){var i,s=new RegExp("\\s+"+t+"\\s+");return e&&this.hasClass(e,t)&&(i=" "+e.className+" ",e.classList?e.classList.remove(t):e.className=i.replace(s," ").trim()),this},a.toggleClass=function(e,t){var i,s=new RegExp("\\s+"+t+"\\s+");return e&&(e.classList?e.classList.toggle(t):(t=" "+t+" ",(i=" "+e.className+" ").indexOf(t)>-1?e.className=i.replace(s," ").trim():e.className+=" "+t)),this},a.fullScreen=function(t,i){var s=this.fsApi;return s?i?e[s.exitFullscreen]():t[s.requestFullscreen]():this.fullPage(t,i),this},a.fullPage=function(e,t){t?a.removeClass(e,"fixed"):a.addClass(e,"fixed")},a.selectElement=function(t,i){var s;i=i||e,t&&(t.nodeName||(o=t,o&&o.window===o)?s=t:"string"==typeof t&&(/^#[^>~+\[\]\s]+$/.test(t)?(s=e.getElementById(t.substring(1)),console.log(t,s)):s=i.querySelector(t)));var o;return s},a._on=function(e,i,s){var o,r=e.guid;r||(r=t++,Object.defineProperty(e,"guid",{value:r})),(o=this.handlers[r])?o[i]||(o[i]=[]):(o=this.handlers[r]={})[i]=[],o[i].push(s),e.addEventListener(i,s)},a.on=function(e,t,i,s){var o,r,n=this.selectElement(e);if(n)if(l(i))for(o=(t=t.split(" ")).length;o--;)r=t[o],s?this._off(n,r,i):this._on(n,r,i);else this._off(n,t);return this},a._off=function(e,t,i){var s,o=e.guid,r=this.handlers[o],n=0;if(r)if(t&&(r=r[t]))if(s=r.length,i){for(;n<s;n++)if(r[n]===i){r.splice(n,1),e.removeEventListener(t,i);break}}else r.forEach(function(i){e.removeEventListener(t,i)}),a.handlers[t]=[];else if(u(t))for(n in r)this._off(e,n)},a.off=function(e,t,i){return this.on(e,t,i,!0)},a.once=function(e,t,i){var s,o=this;l(i)&&(s=function(){var r=Array.prototype.slice.call(arguments);i.apply(this,r),o.off(e,t,s)},this.on(e,t,s))};a.fsApi=function(){for(var e,t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=null,o=i[0],r=0,n=i.length;r<n;r++)if((e=i[r])[1]in document){t=!0;break}return t&&(s={},e.forEach(function(e,t){s[o[t]]=e})),s}();function h(e){this.config=e}h.prototype={constructor:h,setVolume:function(e){return e>=1&&(e/=100),this.el.volume=e,this.el.muted=!e,this},getVolume:function(){return Math.floor(100*this.el.volume)},mute:function(){return this.el.muted=!0,this},unMute:function(){return this.el.muted=!1,this},isMuted:function(){return this.el.muted},autoPlay:function(e){return this.el.autoplay=!!e,this},isAutoPlay:function(){return this.el.autoplay},play:function(){return this.el.play(),this},pause:function(){return this.el.pause(),this},isPaused:function(){return this.el.paused},isError:function(){var e=this.el.error;return e?e.code:e},loop:function(e){return this.el.loop=!!e,this},isLoop:function(){return this.el.loop},setPoster:function(e){return this.el.poster=e,this},setPreload:function(e){return this.el.preload=e,this},setCurrentTime:function(e,t){var i=this.getDuration();return t&&(e*=i),this.el.currentTime=e,this},getCurrentTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration},getPlayedPercentage:function(){return this.getCurrentTime()/this.getDuration()},getBuffered:function(e){var t=this.el.buffered,i=t.length;return e&&i&&(t=t.end(i-1)/this.getDuration()),t},getReadyState:function(){return this.el.readyState},showControls:function(){return this.el.controls=!0,this},convertTime:function(e){var t,i,s,o,r=function(e){return e<10?"0"+e:e.toString()};return(e=Math.ceil(e))<=0?t="00:00":e<60?t="00:"+r(e):e<3600?(o=e%60,t=r(s=Math.floor(e/60))+":"+r(o)):(i=Math.floor(e/3600),t=e%3600,s=Math.floor(t/60),o=t%60,t=r(i)+":"+r(s)+":"+r(o)),t},reload:function(){return this.el.load(),this},changeSource:function(e){var t=this.isPaused();return this.source!==e&&this.initSource(),t||this.play(),this},getSource:function(){return this.el.currentSrc},initSource:function(t){var i=e.createDocumentFragment();return"string"==typeof t?this.el.src=t:Array.isArray(t)&&(this.el.innerHTML="",t.forEach(function(t){var s=e.createElement("source");s.src=t,i.appendChild(s)}),this.el.appendChild(i)),this},init:function(){var t=e.createElement("video"),i=e.createTextNode(this.config.msg.toString());return this.el=t,this.el.loop=this.config.loop,this.el.autoplay=this.config.autoPlay,t.appendChild(i),a.addClass(this.el,"rplayer-video"),this.initSource(this.config.source).autoPlay(this.config.autoPlay).setPoster(this.config.poster).setPreload(this.config.preload).setVolume(this.config.defaultVolume),this.el}};function c(e,t){var s,o=a.selectElement(e);r=t;var r;if((s="[object Object]"===Object.prototype.toString.call(r)?{autoPlay:!!t.autoPlay,defaultVolume:Math.abs(parseInt(t.defaultVolume))||i.defaultVolume,loop:!!t.loop,msg:t.msg||i.msg,poster:t.poster||i.poster,preload:t.preload||i.preload,source:t.source}:i).source||new Error("没有设置视频链接"),!o)throw new Error("未选中任何元素");this.target=o,this.video=new h(s),this.controls=!!u(t.controls)||!!t.controls,this.useNativeControls=!u(t.useNativeControls)&&t.useNativeControls}var d=c.prototype;return d.toggleFullScreen=function(){(this.isFullScreen=!this.isFullScreen)?this.requestFullScreen():this.exitFullScreen()},d.requestFullScreen=function(){this.isFullScreen=!0,a.fullScreen(this.container).addClass(this.fullScreenBtn,"fullscreen").addClass(this.container,"fullscreen")},d.exitFullScreen=function(){this.isFullScreen=!1,a.fullScreen(this.container,!0).removeClass(this.fullScreenBtn,"fullscreen").removeClass(this.container,"fullscreen")},d.initFullScreenEvent=function(){var t=this,i=a.fsApi;return i&&a.on(e,i.fullscreenchange,function(){e[i.fullscreenElement]||t.exitFullScreen()}).on(e,i.fullscreenerror,function(){t.exitFullScreen()}),a.on(this.fullScreenBtn,"click",function(){t.toggleFullScreen()}),this},d.updateVolume=function(e){return e=Math.floor(e),this.video.setVolume(e),this.updateVolumeStyle(e),this},d.updateVolumeByStep=function(e){var t=this.video.getVolume();t=(t+=e)>100?100:t<0?0:t,this.updateVolume(t),this.toggleVolumePopupInfo(t)},d.updateVolumeStyle=function(e){var t=this.showVolumePopBtn.className;return t=t.replace(/volume-[^\s]*/,""),t+=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.volumeSlider.style.bottom=this.volumeValue.style.height=e+"%",this.showVolumePopBtn.className=this.muteBtn.className=t,this.currentVolume.innerHTML=e,this},d.toggleVolumeSettingsPanel=function(e){a.hasClass(this.controlsPanel,"rplayer-disabled")||a.toggleClass(this.volumePopup,n),e.stopPropagation()},d.slideVolumeSlider=function(t){if(!t.button){var i=this.volumeSlider.offsetTop+12,s=t.clientY,o=this.volumeSlider.parentNode.offsetHeight,r=this;a.on(e,"mousemove",function(e){var t=e.clientY,n=o-(t-s+i);n=(n=n<0?0:n>o?o:n)/o*100,r.updateVolume(n)}).on(e,"mouseup",function(){a.off(e,"mousemove").off(e,"mouseup")}),t.preventDefault()}},d.mute=function(){this.video.isMuted()?(this.video.unMute(),this.updateVolumeStyle(this.video.getVolume())):(this.video.mute(),this.updateVolumeStyle(0))},d.initVolumeEvent=function(){var e=this;return a.on(this.showVolumePopBtn,"click",this.toggleVolumeSettingsPanel.bind(this)).on(this.volumePopup,"mouseleave",this.toggleVolumeSettingsPanel.bind(this)).on(this.volumeSlider,"mousedown",this.slideVolumeSlider.bind(this)).on(this.volumeProgress,"click",function(t){var i=this.getBoundingClientRect(),s=t.clientY;i=(i.height-s+i.top)/i.height*100,e.updateVolume(i)}).on(e.muteBtn,"click",this.mute.bind(this)),this},d.togglePlay=function(){a.hasClass(this.controlsPanel,"rplayer-disabled")||(this.video.isPaused()?this.play():this.pause())},d.play=function(){return a.addClass(this.playBtn,"paused"),this.video.play(),this},d.pause=function(){this.video.pause(),a.removeClass(this.playBtn,"paused")},d.showPopupTimeInfo=function(e){var t=this.video.getDuration(),i=this.videoPopupTime;if(t){a.removeClass(i,n);var s=this.videoTrack.getBoundingClientRect(),o=e.clientX-s.left,r=i.offsetWidth,l=o-r/2,u=s.width-r;l=l<0?0:l>u?u:l,i.innerHTML=this.video.convertTime(o/s.width*t),i.style.left=l+"px"}},d.hidePopupTimeInfo=function(){return a.addClass(this.videoPopupTime,n),this},d.slideVideoSlider=function(t){if(!t.button){var i,s=this.videoSlider.offsetLeft,o=t.clientX,r=this.videoSlider.parentNode.offsetWidth,n=this,l=this.video.isPaused();a.on(e,"mousemove",function(e){var t=e.clientX;i=(i=t-o+s)<0?0:i>r?r:i,i/=r,a.addClass(n.videoSlider,"moving"),n.updateProgressPosition(i),n.video.pause()}).on(e,"mouseup",function(){a.off(e,"mousemove").off(e,"mouseup"),a.removeClass(n.videoSlider,"moving"),i&&n.video.setCurrentTime(i,!0),l||n.video.play()}),t.preventDefault()}},d.showLoading=function(){return a.removeClass(this.loading,n),this},d.hideLoading=function(){return a.addClass(this.loading,n),this},d.progress=function(){var e=this.video.getBuffered(),t=e.length;t&&t<100&&(t=(t=e.end(t-1))/this.video.getDuration()*100,this.bufferedBar.style.width=t+"%"),console.log(this.video.getReadyState()),this.video.getReadyState()<3&&this.showLoading()},d.updateProgressPosition=function(e){return u(e)&&(e=this.video.getPlayedPercentage()),this.videoProgress.style.width=this.videoSlider.style.left=100*e+"%",this.updateCurrentTime(),this},d.updateProgressByStep=function(e){var t=this.video.getCurrentTime(),i=this.video.getDuration();t=(t+=e)<0?0:t>i?i:t,this.video.setCurrentTime(t),this.updateProgressPosition().updateCurrentTime()},d.updateCurrentTime=function(){return this.currentTime.innerHTML=this.video.convertTime(this.video.getCurrentTime()),this},d.updateTotalTime=function(){return this.totalTime.innerHTML=this.video.convertTime(this.video.getDuration()),this},d.updateMetaInfo=function(){this.video.isAutoPlay()&&this.play(),this.updateTotalTime().enableControls()},d.hideControls=function(){return a.addClass(this.controlsPanel,n),this},d.showControls=function(){var e=this;if(null==this.video.isError())return clearTimeout(r),a.removeClass(this.controlsPanel,n),a.hasClass(this.volumePopup,n)&&(r=setTimeout(function(){e.hideControls()},5e3)),this},d.enableControls=function(){return a.removeClass(this.controlsPanel,"rplayer-disabled"),this},d.disableControls=function(){return a.addClass(this.controlsPanel,"rplayer-disabled"),this},d.loop=function(){this.video.isLoop()?this.play():this.pause()},d.toggleError=function(){var e=this.errorMsg.parentNode;return a.toggleClass(e,n),this.hideLoading().hideControls(),this},d.error=function(){var e,t=this.video.isError();switch(t=s[t]){case"MEDIA_ERR_ABORTED":e="出错了";break;case"MEDIA_ERR_NETWORK":e="网络错误或视频地址无效";break;case"MEDIA_ERR_DECODE":case"MEDIA_ERR_SRC_NOT_SUPPORTED":e="解码失败,不支持的视频格式或地址无效"}e+=",点击刷新",this.errorMsg.innerHTML=e,this.toggleError()},d.refresh=function(){this.video.reload(),this.toggleError()},d.initPlayEvent=function(){var e=this,t=this.video.el;return a.on(this.playBtn,"click",function(){e.togglePlay()}).on(this.videoTrack,"click",function(t){var i=this.getBoundingClientRect();i=(t.clientX-i.left)/i.width,e.video.setCurrentTime(i,!0),e.updateProgressPosition(i)}).on(this.videoTrack,"mouseover mousemove",this.showPopupTimeInfo.bind(this)).on(this.videoTrack,"mouseout",this.hidePopupTimeInfo.bind(this)).on(this.videoSlider,"mousedown",this.slideVideoSlider.bind(this)).on(this.container,"keydown",this.keyDown.bind(this)).on(this.container,"mousemove",this.showControls.bind(this)).on(this.errorMsg,"click",this.refresh.bind(this)).on(t,"loadstart stalled",function(){e.showLoading().disableControls()}).on(t,"loadedmetadata",this.updateMetaInfo.bind(this)).on(t,"timeupdate",function(){e.updateProgressPosition()}).on(t,"canplay seeked",this.hideLoading.bind(this)).on(t,"progress",this.progress.bind(this)).on(t,"error",this.error.bind(this)).on(t,"seeking",this.showLoading.bind(this)).on(t,"ended",this.loop.bind(this)).on(t,"click",this.togglePlay.bind(this)).on(t,"dblclick",this.toggleFullScreen.bind(this)),this},d.toggleVolumePopupInfo=function(e){var t=this;return a.hasClass(this.volumePopup,n)&&(clearTimeout(o),this.volumePopupInfo.innerHTML="当前音量: "+e,this.currentVolume.innerHTML=e,a.removeClass(this.volumePopupInfo,n),o=setTimeout(function(){a.addClass(t.volumePopupInfo,n)},3e3)),this},d.keyDown=function(e){if(!a.hasClass(this.controlsPanel,"rplayer-disabled")){var t=e.key.toLowerCase(),i={up:5,arrowup:5,down:-5,arrowdown:-5,left:-10,arrowleft:-10,right:10,arrowright:10,esc:"esc",escape:"escape"}[t];i?(/(left)|(right)/.test(t)?this.updateProgressByStep(i):/(up)|(down)/.test(t)?this.updateVolumeByStep(i):this.toggleFullScreen(),e.preventDefault()):" "!==t&&"space"!==t||(this.togglePlay(),e.preventDefault())}},d.initEvent=function(){return this.initPlayEvent().initVolumeEvent().initFullScreenEvent()},d.offEvent=function(){return a.off(e).off(this.showVolumePopBtn).off(this.volumePopup).off(this.volumeSlider).off(this.volumeProgress).off(this.muteBtn).off(this.playBtn).off(this.videoTrack).off(this.container).off(this.video.el).off(this.errorMsg),this},d.removeProp=function(){return delete this.playBtn,delete this.videoTrack,delete this.videoSlider,delete this.videoProgress,delete this.videoPopupTime,delete this.currentTime,delete this.totalTime,delete this.bufferedBar,delete this.showVolumePopBtn,delete this.muteBtn,delete this.volumePopup,delete this.volumePopupInfo,delete this.volumeSlider,delete this.volumeProgress,delete this.volumeValue,delete this.currentVolume,delete this.fullScreenBtn,delete this.video,delete this.container,delete this.controlsPanel,delete this.isFullScreen,delete this.loading,delete this.useNativeControls,delete this.controls,delete this.target,delete this.errorMsg,this},d.destroy=function(){return this.container&&(this.target.removeChild(this.container),this.offEvent().removeProp()),this},d.initEssentialElements=function(){var e=this.container;return this.loading=a.selectElement(".rplayer-loading",e),this},d.initElements=function(){var e=this.container;return this.playBtn=a.selectElement(".rplayer-play-btn",e),this.videoTrack=a.selectElement(".rplayer-video-track",e),this.videoSlider=a.selectElement(".rplayer-video-slider",e),this.videoProgress=a.selectElement(".rplayer-video-progress",e),this.videoPopupTime=a.selectElement(".rplayer-popup-video-info",e),this.currentTime=a.selectElement(".rplayer-current-time",e),this.totalTime=a.selectElement(".rplayer-total-time",e),this.bufferedBar=a.selectElement(".rplayer-bufferd-bar",e),this.showVolumePopBtn=a.selectElement(".rplayer-audio-btn",e),this.muteBtn=a.selectElement(".rplayer-mute",e),this.volumePopup=a.selectElement(".rplayer-volume-popup",e),this.volumePopupInfo=a.selectElement(".rplayer-popup-volume-info",e),this.volumeSlider=a.selectElement(".rplayer-volume-slider",e),this.volumeProgress=a.selectElement(".rplayer-volume-progress",e),this.volumeValue=a.selectElement(".rplayer-volume-value",e),this.currentVolume=a.selectElement(".rplayer-current-volume",e),this.fullScreenBtn=a.selectElement(".rplayer-fullscreen-btn",e),this.errorMsg=a.selectElement(".rplayer-msg",e),this},d.initPlayState=function(){},d.getSource=function(){return this.video.getSource()},d.initialize=function(){if(!this.container){var t=e.createElement("div"),i=parseInt(getComputedStyle(this.target).height);return this.isFullScreen=!1,t.tabIndex=100,t.innerHTML='<div class="rplayer-loading rplayer-hide"></div><div class="rplayer-popup-info rplayer-popup-volume-info rplayer-hide">10:00</div><div class="rplayer-error rplayer-hide"><div class="rplayer-msg">出错了</div></div>',t.style.height=(i||500)+"px",this.container=t,t.appendChild(this.video.init()),a.addClass(this.container,"rplayer-container"),this.controls&&!this.useNativeControls?(this.controlsPanel=e.createElement("div"),a.addClass(this.controlsPanel,"rplayer-controls"),this.controlsPanel.innerHTML='<div class="rplayer-popup-info rplayer-popup-video-info rplayer-hide">10:00</div>        <div class="rplayer-progress-panel">            <div class="rplayer-progress rplayer-video-track">                <div class="rplayer-bufferd-bar"></div>                <div class="rplayer-bar rplayer-video-progress"></div>                <div class="rplayer-progress-track">                    <div class="rplayer-slider rplayer-video-slider"></div>                </div>            </div>        </div>        <div class="rplayer-play-control rplayer-lf">            <button type="button" class="rplayer-play-btn"></button>            <span class="rplayer-time-info">               <span class="rplayer-current-time">00:00</span>/               <span class="rplayer-total-time">00:00</span>             </span>        </div>        <div class="rplayer-settings rplayer-rt">            <button type="button" class="rplayer-fullscreen-btn rplayer-rt"></button>            <div class="rplayer-audio-control rplayer-rt">                <button type="button" class="rplayer-audio-btn volume-1"></button>                <div class="rplayer-volume-popup rplayer-hide">                    <span class="rplayer-current-volume">12</span>                    <div class="rplayer-progress rplayer-volume-progress">                        <div class="rplayer-bar rplayer-volume-value"></div>                        <div class="rplayer-audio-track">                            <div class="rplayer-slider rplayer-volume-slider"></div>                        </div>                    </div>                    <button class="rplayer-mute volume-1"></button>                </div>            </div>        </div>',this.container.appendChild(this.controlsPanel),this.initElements().updateVolumeStyle(this.video.getVolume()).initEvent()):this.useNativeControls&&this.video.showControls(),this.target.appendChild(this.container),this.initEssentialElements(),this}},d.updateSource=function(e){this.video.changeSource(e)},c.init=function(e,t){return new c(e,t).initialize()},c});