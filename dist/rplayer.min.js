!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.RPlayer=t()}(this,function(){"use strict";var e={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:"",useNativeControls:!1},t={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},n={function:"[object Function]",object:"[object Object]",string:"[object String]",undef:"[object Undefined]"},i={up:5,arrowup:5,down:-5,arrowdown:-5,left:-10,arrowleft:-10,right:10,arrowright:10,esc:"esc",escape:"escape"," ":"space",spacebar:"space",enter:"enter"},r=document,o=function(e){return function(t){return Object.prototype.toString.call(t)===n[e]}},s=o("function"),a=o("object"),l=o("string"),u=o("undef");function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.isArray(e)?e.slice(t):e.length?Array.prototype.slice.call(e,t):[]}function c(e,t){if(t)try{delete e[t]}catch(e){}else for(t in e)e[t]=null,delete e[t]}function f(e){var t=function(e){return e<10?"0"+e:e.toString()},n=void 0,i=void 0,r=void 0,o=void 0;return(e=Math.ceil(e))<=0?n="00:00":e<60?n="00:"+t(e):e<3600?(o=e%60,n=t(r=Math.floor(e/60))+":"+t(o)):(i=Math.floor(e/3600),n=e%3600,r=Math.floor(n/60),o=n%60,n=t(i)+":"+t(r)+":"+t(o)),n}var p={handlers:{}},d=1;p.hasClass=function(e,t){return!!e&&(e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1)},p.addClass=function(e,t){return e&&!this.hasClass(e,t)&&(e.classList?e.classList.add(t):e.className+=" "+t),this},p.removeClass=function(e,t){var n=new RegExp("\\s+"+t+"\\s+"),i=void 0;return e&&this.hasClass(e,t)&&(i=" "+e.className+" ",e.classList?e.classList.remove(t):e.className=i.replace(n," ").trim()),this},p.toggleClass=function(e,t){var n=new RegExp("\\s+"+t+"\\s+"),i=void 0;return e&&(e.classList?e.classList.toggle(t):(t=" "+t+" ",(i=" "+e.className+" ").indexOf(t)>-1?e.className=i.replace(n," ").trim():e.className+=" "+t)),this},p.css=function(e,t,n){var i="";if(u(n)){if(a(t)){for(n in t)i+=n+":"+t[n]+";";e.style.cssText+=i}else if(l(t))return getComputedStyle(e).getPropertyValue(t)}else e.style[t]=n;return this},p.selectElement=function(e,t){var n=void 0;t=t||r,e&&(e.nodeName||(i=e,i&&i.window===i)?n=e:"string"==typeof e&&(n=/^#[^>~+\[\]\s:]+$/.test(e)?r.getElementById(e.substring(1)):t.querySelector(e)));var i;return n},p.createElement=function(e,t){var n=r.createElement(e),i=void 0;if(a(t))for(i in t)n.setAttribute(i,t[i]);return n},p._on=function(e,t,n){var i=e.guid,r=void 0;i||(i=d++,Object.defineProperty(e,"guid",{value:i})),(r=this.handlers[i])?r[t]||(r[t]=[]):(r=this.handlers[i]={})[t]=[],r[t].push(n),e.addEventListener(t,n)},p.on=function(e,t,n,i){var r=this.selectElement(e),o=void 0;if(r)if(t){if(o=(t=t.split(" ")).length,s(n))for(;o--;){var a=t[o];i?this._off(r,a,n):this._on(r,a,n)}else if(i)for(;o--;)this._off(r,t[o])}else i&&this._off(r);return this},p._off=function(e,t,n){var i=this.handlers[e.guid];if(i)if(t&&(i=i[t]))if(n){for(var r=0,o=i.length;r<o;r++)if(i[r]===n){i.splice(r,1),e.removeEventListener(t,n);break}}else i.forEach(function(n){e.removeEventListener(t,n)}),p.handlers[t]=[];else if(!t)for(var s in i)this._off(e,s)},p.off=function(e,t,n){return this.on(e,t,n,!0)},p.once=function(e,t,n){var i=void 0,r=this;return s(n)&&(i=function(){var o=Array.prototype.slice.call(arguments);n.apply(this,o),r.off(e,t,i)},this.on(e,t,i)),this},p.isPositionInEl=function(e,t,n,i){var r=e.getBoundingClientRect();return i&&(t-=r.left,n-=r.top),t>0&&t<r.width&&n>0&&n<r.height};var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function y(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"handlers",{value:{}})}return v(e,[{key:"_on",value:function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)}},{key:"on",value:function(e,t){if(s(t)){if(!l(e))throw new TypeError("事件类型只能为String");for(var n=(e=e.split(" ")).length;n--;)this._on(e[n],t)}return this}},{key:"_off",value:function(e,t){var n=this.handlers[e];if(n)if(s(t)){for(var i=n.length;i--;)if(t===n[i]){n.splice(i,1);break}}else u(t)&&(this.handlers[e]=[])}},{key:"off",value:function(e,t){var n=arguments.length;if(n&&l(e))for(var i=h(arguments,1),r=(e=e.split(" ")).length;r--;){var o;(o=this._off).call.apply(o,[this,e[r]].concat(y(i)))}else n||(this.handlers={});return this}},{key:"once",value:function(e,t){if(s(t)){var n=this;this.on(e,function i(){t.apply(this,arguments),n.off(e,i)})}}},{key:"trigger",value:function(e){var t=h(arguments,1),n=this.handlers[e],i=void 0;if(n){(i=new function(e){this.type=e,this.data=null,this.timeStamp=0}(e)).data=t,i.timeStamp=Date.now(),t=[i].concat(t);for(var r=n.length;r--;)n[r].apply(this,t)}return this}}]),e}(),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=p.createElement("div",{class:"rplayer-loading rplayer-hide"})}return g(e,[{key:"show",value:function(){return p.removeClass(this.el,"rplayer-hide"),this}},{key:"hide",value:function(){return p.addClass(this.el,"rplayer-hide"),this}},{key:"toggle",value:function(){return p.toggleClass(this.el,"rplayer-hide"),this}},{key:"init",value:function(e){return e.appendChild(this.el),this}}]),e}(),k=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=p.createElement("div",{class:"rplayer-error rplayer-hide"}),this.msgEl=p.createElement("div",{class:"rplayer-msg"}),this.callback=function(){}}return k(e,[{key:"show",value:function(e){return this.setMessage(e),p.removeClass(this.el,"rplayer-hide"),this}},{key:"hide",value:function(){return p.addClass(this.el,"rplayer-hide"),this}},{key:"setMessage",value:function(e){return this.msgEl.innerHTML=e,this}},{key:"initEvent",value:function(){return p.on(this.msgEl,"click",this.callback),this}},{key:"init",value:function(e,t){return this.el.appendChild(this.msgEl),e.appendChild(this.el),s(t)&&(this.callback=t),this.initEvent()}}]),e}(),w=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P="video.loaded.meta",T="video.time.update",_="video.seeking",O="video.load.start",S="video.progress",j="video.can.play",x="video.error",R="video.playing",M="video.dblclick",F="video.volume.change",D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,m);function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.config=e,t.playedTime=null,t.el=p.createElement("video",{class:"rplayer-video"}),t}return w(n,[{key:"setVolume",value:function(e){return e>1&&(e/=100),this.el.volume=e,this}},{key:"getVolume",value:function(){return Math.floor(100*this.el.volume)}},{key:"mute",value:function(e){return this.el.muted=!!u(e)||!!e,this}},{key:"isMuted",value:function(){return this.el.muted}},{key:"autoPlay",value:function(e){return this.el.autoplay=!!e,this}},{key:"play",value:function(e){return u(e)?this.el.play():this.el.pause(),this}},{key:"togglePlay",value:function(){return this.getDuration()&&this.play(this.isPaused()),this}},{key:"isPaused",value:function(){return this.el.paused}},{key:"isError",value:function(){var e=this.el.error;return e?e.code:e}},{key:"loop",value:function(e){return this.el.loop=!!e,this}},{key:"setPoster",value:function(e){return this.el.poster=e,this}},{key:"setPreload",value:function(e){return this.el.preload=e,this}},{key:"setCurrentTime",value:function(e,t){var n=this.getDuration();return t&&(e=n*t),this.el.currentTime=e,this}},{key:"getCurrentTime",value:function(){return this.el.currentTime}},{key:"getDuration",value:function(){return this.el.duration}},{key:"getBuffered",value:function(e){var t=this.el.buffered,n=t.length;return e?n?t=t.end(n-1)/this.getDuration()*100:null:t}},{key:"getReadyState",value:function(){return this.el.readyState}},{key:"showControls",value:function(){return this.el.controls=!0,this}},{key:"reload",value:function(){return this.el.load(),this}},{key:"changeSource",value:function(e){var t=this.isPaused();return this.source!==e&&(this.source=e,this.initSource(e)),t||this.play(!0),this}},{key:"getSource",value:function(){return this.el.currentSrc}},{key:"initSource",value:function(e){var t=r.createDocumentFragment();return"string"==typeof e?this.el.src=e:Array.isArray(e)&&(this.el.innerHTML="",e.forEach(function(e){var n=p.createElement("source",{src:e});t.appendChild(n)}),this.el.appendChild(t)),this}},{key:"handleError",value:function(){var e=this.isError(),n=void 0;switch(t[e]){case"MEDIA_ERR_ABORTED":n="出错了";break;case"MEDIA_ERR_NETWORK":n="网络错误或视频地址无效";break;case"MEDIA_ERR_DECODE":case"MEDIA_ERR_SRC_NOT_SUPPORTED":n="解码失败,不支持的视频格式或地址无效"}return{code:e,message:n+=",点击刷新"}}},{key:"notify",value:function(e){var t,n=(t={},C(t,P,[{duration:this.getDuration()}]),C(t,T,[this.getCurrentTime()]),C(t,S,[this.getBuffered(!0),this.getReadyState()]),C(t,x,[this.handleError()]),C(t,F,[this.isMuted()?0:this.getVolume()]),t)[e]||[];switch(e){case O:this.playedTime&&(this.setCurrentTime(this.playedTime),this.playedTime=0);break;case x:this.playedTime=this.getCurrentTime()}return this.trigger.apply(this,[e].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n)))}},{key:"initEvent",value:function(){var e=this.el;p.on(e,"loadedmetadata",this.notify.bind(this,P)).on(e,"timeupdate",this.notify.bind(this,T)).on(e,"seeking",this.notify.bind(this,_)).on(e,"loadstart",this.notify.bind(this,O)).on(e,"progress",this.notify.bind(this,S)).on(e,"canplay seeked",this.notify.bind(this,j)).on(e,"ended",this.notify.bind(this,"video.ended")).on(e,"error",this.notify.bind(this,x)).on(e,"playing",this.notify.bind(this,R)).on(e,"pause",this.notify.bind(this,"video.pause")).on(e,"volumechange",this.notify.bind(this,F)).on(e,"dblclick",this.notify.bind(this,M)).on(e,"click",this.notify.bind(this,"video.click")).on(e,"contextmenu",function(e){return e.preventDefault()})}},{key:"init",value:function(e){var t=this.el,n=r.createTextNode(this.config.msg.toString());return this.source=this.config.source,this.config.useNativeControls&&this.showControls(),t.appendChild(n),e.appendChild(t),this.initSource(this.source).autoPlay(this.config.autoPlay).loop(this.config.loop).setPoster(this.config.poster).setPreload(this.config.preload).initEvent(),this}},{key:"destroy",value:function(){p.off(this.el),this.off(),c(this)}}]),n}(),N=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var A="slider.moving",V="slider.move.done",B="slider.status.change",L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m);function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.vertical=!u(e)&&!!e,n.moveDis=n.pos=null,n.moving=!1,n.enabled=!0,n.track=p.createElement("div",{class:"rplayer-progress"}),n.bar=p.createElement("div",{class:"rplayer-bar"}),n.el=p.createElement("div",{class:"rplayer-slider"}),n}return N(t,[{key:"getPosition",value:function(){var e=this.el.parentNode.getBoundingClientRect(),t=getComputedStyle(this.el);return{width:parseFloat(t.width),height:parseFloat(t.height),origLeft:parseFloat(t.left),origTop:parseFloat(t.top),maxX:e.width,maxY:e.height}}},{key:"updateHPosition",value:function(e,t){return t&&(e=100*e+"%"),p.css(this.bar,"width",e).css(this.el,"left",e),this}},{key:"updateVPosition",value:function(e,t){return t&&(e=100*e+"%"),p.css(this.bar,"height",e).css(this.el,"bottom",e),this}},{key:"mouseDown",value:function(e){if(!e.button&&this.enabled){var t=e.clientX,n=e.clientY,i=this.getPosition(),o=this.getMoveCallback().bind(this);this.pos={width:i.width,height:i.height,offsetX:t-i.origLeft,offsetY:n-i.origTop,maxX:i.maxX,maxY:i.maxY},p.addClass(this.el,"rplayer-moving").on(r,"mousemove",o).on(r,"mouseup",this.mouseUp.bind(this))}}},{key:"moveVertical",value:function(e,t){var n=void 0;return n=(n=this.pos.maxY-(t-this.pos.offsetY)-this.pos.height)<0?0:n>this.pos.maxY?this.pos.maxY:n,n/=this.pos.maxY,this.updateVPosition(n,!0),n}},{key:"moveHorizontal",value:function(e){var t=void 0;return t=(t=e-this.pos.offsetX)<0?0:t>this.pos.maxX?this.pos.maxX:t,t/=this.pos.maxX,this.updateHPosition(t,!0),t}},{key:"mouseMove",value:function(e,t){var n=e.clientX,i=e.clientY,r=t.call(this,n,i);this.moving=!0,this.trigger(A,this.moveDis=r)}},{key:"getMoveCallback",value:function(){var e=this;return this.vertical?function(t){return e.mouseMove(t,e.moveVertical)}:function(t){return e.mouseMove(t,e.moveHorizontal)}}},{key:"mouseUp",value:function(){var e=this;p.off(r,"mousemove mouseup").removeClass(this.el,"rplayer-moving"),this.moving&&(this.trigger(V,this.moveDis),setTimeout(function(){return e.moving=!1}))}},{key:"clickTrack",value:function(e){if(!this.moving&&this.enabled){var t=this.track.getBoundingClientRect(),n=e.clientX,i=e.clientY,r="slider.moving";this.vertical?(t=(t.height-i+t.top)/t.height,this.updateVPosition(t,!0)):(t=(n-t.left)/t.width,r="slider.move.done",this.updateHPosition(t,!0)),this.trigger(r,t)}}},{key:"initEvent",value:function(){var e=this;return p.on(this.el,"mousedown",this.mouseDown.bind(this)).on(this.track,"click",this.clickTrack.bind(this)),this.on(B,function(t,n){return e.enabled=!!n}),this}},{key:"destroy",value:function(){p.off(this.track).off(this.el),c(this)}},{key:"init",value:function(e){var t={track:"rplayer-video-track",bar:"rplayer-video-progress",slider:"rplayer-video-slider"};return this.vertical&&(t={track:"rplayer-volume-progress",bar:"rplayer-volume-value",slider:"rplayer-volume-slider"}),p.addClass(this.track,t.track).addClass(this.bar,t.bar).addClass(this.el,t.slider),this.track.appendChild(this.bar),this.track.append(this.el),e.appendChild(this.track),this.initEvent()}}]),t}(),I=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var H=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=p.createElement("div",{class:"rplayer-popup-info rplayer-hide "+t}),this.visible=!1,this.autoHide=!!n,this.timer=null}return I(e,[{key:"show",value:function(e){var t=this;return this.visible=!0,this.timer&&(clearTimeout(this.timer),this.timer=null),this.autoHide&&(this.timer=setTimeout(function(){return t.hide()},3e3)),p.removeClass(this.el,"rplayer-hide"),e&&this.updateText(e),this}},{key:"hide",value:function(){return this.visible=!1,p.addClass(this.el,"rplayer-hide"),this}},{key:"updatePosition",value:function(e){var t={left:"left",right:"right",top:"top",bottom:"bottom"};if(a(e))for(var n in e)t[n]&&p.css(this.el,n,e[n]);return this}},{key:"updateText",value:function(e){return this.el.innerHTML=e,this}},{key:"getSize",value:function(e){var t=this.visible;!t&&this.show();var n=getComputedStyle(this.el);return!t&&this.hide(),e?parseFloat(n[e]):{left:parseFloat(n.left),right:parseFloat(n.right),top:parseFloat(n.top),bottom:parseFloat(n.bottom),width:parseFloat(n.width)}}},{key:"width",value:function(){return this.getSize("width")}},{key:"height",value:function(){return this.getSize("height")}},{key:"init",value:function(e){return e.appendChild(this.el),this}}]),e}(),z=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var X="video.progress.update",Y="video.progress.updated",q="video.progress.enable",U="video.progress.buffer",K="video.progress.duration",W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m);function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.slider=new L,e.panel=p.createElement("div",{class:"rplayer-progress-panel"}),e.bufferEl=p.createElement("div",{class:"rplayer-bufferd-bar"}),e.popup=new H("rplayer-popup-video-info"),e.currentTime=e.duration=0,e}return z(t,[{key:"update",value:function(e,t){if(this.currentTime!==e){this.currentTime=e;var n=e/this.duration*100||0;!t&&this.slider.updateHPosition(n+"%")}return this}},{key:"updateByStep",value:function(e){var t=this.currentTime,n=this.duration;return n&&(t+=e,this.currentTime=t<0?0:t>n?n:t,this.trigger(X,this.currentTime)),this}},{key:"buffer",value:function(e){p.css(this.bufferEl,e+"%")}},{key:"mouseMove",value:function(e){if(this.duration){this.popup.show();var t=this.panel.getBoundingClientRect(),n=e.clientX-t.left,i=this.popup.width(),r=n-i/2;i=t.width-i,r=r<0?0:r>i?i:r,i=n/t.width,this.popup.updatePosition({left:r+"px"}).updateText(f(i*this.duration))}}},{key:"mouseOut",value:function(){this.popup.hide()}},{key:"initEvent",value:function(){var e=this;return this.slider.on(V,function(t,n){var i=n*e.duration;e.update(i),e.trigger(X,i)}),p.on(this.panel,"mouseover mousemove",this.mouseMove.bind(this)).on(this.panel,"mouseout",this.mouseOut.bind(this)),this.on(Y,function(t,n){return e.update(n)}).on(q,function(t,n){return e.slider.trigger(B,n)}).on(U,function(t,n){return e.buffer(n)}).on(K,function(t,n){return e.duration=n}),this}},{key:"init",value:function(e){var t=this.panel;return t.appendChild(this.bufferEl),this.slider.init(t),this.popup.init(t),e.appendChild(t),this.initEvent()}}]),t}(),$=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var G="volume.control.update",J="volume.control.mute",Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m);function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.panel=p.createElement("div",{class:"rplayer-volume-popup rplayer-hide"}),n.valueEl=p.createElement("div",{class:"rplayer-current-volume"}),n.muteBtn=p.createElement("button",{class:"rplayer-mute volume-1"}),n.showBtn=p.createElement("button",{class:"rplayer-audio-btn volume-1"}),n.slider=new L(!0),n.volume=e,n.muted=!1,n}return $(t,[{key:"show",value:function(){return p.removeClass(this.panel,"rplayer-hide"),this}},{key:"hide",value:function(){return p.addClass(this.panel,"rplayer-hide"),this}},{key:"toggle",value:function(e){return p.toggleClass(this.panel,"rplayer-hide"),e.stopPropagation(),this}},{key:"updateVolume",value:function(e,t){return this.volume=e,this.updateStyle(this.volume,t),this.trigger(G,this.volume),this}},{key:"updateVolumeByStep",value:function(e){var t=this.volume+e;t=t>100?100:t<0?0:t,this.updateVolume(t)}},{key:"updateStyle",value:function(e,t){var n=this.muteBtn.className,i=this.showBtn.className,r=/volume-\S+/;return n=n.replace(r,""),i=i.replace(r,""),r=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.muteBtn.className=n+r,this.showBtn.className=i+r,this.valueEl.innerHTML=e,!t&&this.slider.updateVPosition(e+"%"),this}},{key:"mute",value:function(){this.muted=!this.muted,this.muted?this.updateStyle(0):this.updateStyle(this.volume),this.trigger(J,this.muted)}},{key:"initEvent",value:function(){var e=this;return p.on(this.muteBtn,"click",this.mute.bind(this)).on(this.panel,"mouseleave",this.hide.bind(this)).on(this.showBtn,"click",this.toggle.bind(this)).on(r,"click",function(t){var n=t.target;n===e.panel||e.panel.contains(n)||e.hide()}),this.slider.on(A,function(t,n){e.updateVolume(Math.floor(100*n),!0)}),this}},{key:"init",value:function(e){var t=p.createElement("div",{class:"rplayer-audio-control rplayer-rt"});return this.panel.appendChild(this.valueEl),this.slider.init(this.panel),this.panel.appendChild(this.muteBtn),t.appendChild(this.showBtn),t.append(this.panel),e.appendChild(t),this.updateVolume(this.volume).initEvent(),this}}]),t}(),Z=function(){for(var e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],t=null,n=e[0],i=void 0,r=void 0,o=0,s=e.length;o<s;o++)if((i=e[o])[1]in document){r=!0;break}return r&&(t={},i.forEach(function(e,i){t[n[i]]=e})),t}(),ee=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.isFullScreen=!1,this.btn=p.createElement("button",{class:"rplayer-fullscreen-btn rplayer-rt"})}return ee(e,[{key:"request",value:function(){return this.isFullScreen=!0,Z?this.el[Z.requestFullscreen]():this.fullPage(),p.addClass(this.el,"rplayer-fullscreen").addClass(this.btn,"rplayer-fullscreen"),this}},{key:"exit",value:function(){return this.isFullScreen=!1,Z?r[Z.exitFullscreen]():this.fullPage(!0),p.removeClass(this.btn,"rplayer-fullscreen").removeClass(this.el,"rplayer-fullscreen"),this}},{key:"toggle",value:function(){return this.isFullScreen=this.isFullScreen?this.exit():this.request()}},{key:"fullPage",value:function(e){return e?p.removeClass(this.el,"rplayer-fixed"):p.addClass(this.el,"rplayer-fixed"),this}},{key:"initEvent",value:function(){var e=this;return Z&&p.on(r,Z.fullscreenchange,function(){r[Z.fullscreenElement]||e.exit()}).on(r,Z.fullscreenerror,function(){e.exit()}),p.on(this.btn,"click",this.toggle.bind(this)),this}},{key:"init",value:function(e){return e.appendChild(this.btn),this.initEvent()}}]),e}(),ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentEl=p.createElement("span",{class:"rplayer-current-time"}),this.totalEl=p.createElement("span",{class:"rplayer-total-time"})}return ne(e,[{key:"updateCurrentTime",value:function(e){return this.currentEl.innerHTML=f(e),this}},{key:"updateTotalTime",value:function(e){return this.totalEl.innerHTML=f(e),this}},{key:"init",value:function(e){var t=p.createElement("span",{class:"rplayer-time-info"}),n=r.createTextNode("/");return this.currentEl.innerHTML=this.totalEl.innerHTML="00:00",t.appendChild(this.currentEl),t.appendChild(n),t.appendChild(this.totalEl),e.appendChild(t),this}}]),e}(),re=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var oe="play.control.play",se="play.control.pause",ae="play.control.toggle",le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m);function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.btn=p.createElement("button",{class:"rplayer-play-btn"}),e.paused=!0,e}return re(t,[{key:"play",value:function(){return p.addClass(this.btn,"paused"),this}},{key:"pause",value:function(){return p.removeClass(this.btn,"paused"),this}},{key:"toggle",value:function(){return this.trigger(ae,this.paused=!this.paused),this}},{key:"initEvent",value:function(){return p.on(this.btn,"click",this.toggle.bind(this)),this.on(se,this.pause.bind(this)).on(oe,this.play.bind(this)),this}},{key:"init",value:function(e){return e.appendChild(this.btn),this.initEvent()}}]),t}(),ue=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var he=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentEl=t,this.media=n,this.timer=null,this.el=p.createElement("div",{class:"rplayer-controls"}),this.volumeControl=new Q(i),this.playControl=new le,this.timeInfo=new ie,this.fullScreen=new te(t),this.progress=new W,this.volumePopup=new H("rplayer-popup-volume-info",!0)}return ue(e,[{key:"show",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.media.isError();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!n){var i=t.clientX,r=t.clientY;this.visible=!0,p.removeClass(this.el,"rplayer-hide"),this.timer=setTimeout(function(){e.hide(i,r)},5e3)}return this}},{key:"hide",value:function(e,t){return p.isPositionInEl(this.el,e,t,!0)||p.addClass(this.el,"rplayer-hide"),this}},{key:"keyDown",value:function(e){var t=e.key.toLowerCase(),n=i[t];n&&(/(?:left)|(?:right)/.test(t)?this.progress.updateByStep(n):/(?:up)|(?:down)/.test(t)?this.volumeControl.updateVolumeByStep(n):/esc/.test(t)?this.fullScreen.exit():/\s|(?:spacebar)/.test(t)?this.playControl.toggle():this.fullScreen.toggle()),e.preventDefault()}},{key:"showVolumePopup",value:function(e){var t="当前音量: "+e;return 0===e&&(t="静音"),this.volumePopup.show(t),this}},{key:"updateMeta",value:function(e){var t=e.duration,n=this.progress;this.timeInfo.updateTotalTime(t),n.trigger(q,!0),n.trigger(K,t)}},{key:"updateTime",value:function(e){this.timeInfo.updateCurrentTime(e),this.progress.trigger(Y,e)}},{key:"updateProgress",value:function(e){this.media.setCurrentTime(e),this.timeInfo.updateCurrentTime(e)}},{key:"initEvent",value:function(){var e=this,t=this.media,n=this.playControl,i=this.progress;return t.on(F,function(t,n){return e.showVolumePopup(n)}).on(R,function(){return n.trigger(oe)}).on("video.pause",function(){return n.trigger(se)}).on(O,function(){return i.trigger(q,!1)}).on(P,function(t,n){return e.updateMeta(n)}).on(T,function(t,n){return e.updateTime(n)}).on(S,function(e,t){return i.trigger(U,t)}).on("video.click",function(){return t.togglePlay()}).on(M,function(){return e.fullScreen.toggle()}),n.on(ae,function(e,n){return t.play(n)}),i.on(X,function(t,n){return e.updateProgress(n)}),this.volumeControl.on(J,function(e,n){return t.mute(n)}).on(G,function(e,n){return t.setVolume(n)}),p.on(this.parentEl,"keydown",this.keyDown.bind(this)).on(this.parentEl,"mousemove",this.show.bind(this)),this}},{key:"init",value:function(){var e=p.createElement("div",{class:"rplayer-settings rplayer-rt"}),t=p.createElement("div",{class:"rplayer-play-control rplayer-lf"}),n=this.el;return this.initEvent(),this.fullScreen.init(this.parentEl,e),this.volumeControl.init(e),this.playControl.init(t),this.timeInfo.init(t),this.progress.init(n),this.volumePopup.init(n),n.appendChild(e),n.appendChild(t),this.parentEl.appendChild(n),this.show(),this}}]),e}(),ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var fe=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,m);function n(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r,o=p.selectElement(t),s=(r=i,a(r)?{autoPlay:!!r.autoPlay,loop:!!r.loop,defaultVolume:Math.abs(parseInt(r.defaultVolume))||e.defaultVolume,msg:r.msg||e.msg,poster:r.poster||e.poster,preload:r.preload||e.preload,source:r.source,useNativeControls:!u(r.useNativeControls)&&r.useNativeControls}:e),l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(!s.source)throw new Error("没有设置视频链接");if(!o)throw new Error("未选中任何元素");return l.target=o,l.loading=new b,l.video=new D(s),l.container=p.createElement("div",{tabIndex:100,class:"rplayer-container"}),!u(i.controls)&&!i.controls||s.useNativeControls||(l.controls=new he(l.container,l.video,s.defaultVolume)),l}return ce(n,[{key:"buffer",value:function(e,t){t<3&&this.loading.show()}},{key:"playEnd",value:function(){this.trigger("play.end")}},{key:"handleError",value:function(e){return this.error||(this.error=new E,this.error.init(this.container,this.refresh.bind(this))),this.loading.hide(),this.error.show(e.message),this}},{key:"refresh",value:function(){this.video.reload(),this.error.hide()}},{key:"initEvent",value:function(){var e=this;return this.video.on(O,function(){return e.loading.show()}).on(S,function(t,n,i){return e.buffer(n,i)}).on(_,function(){return e.loading.show()}).on(j,function(){return e.loading.hide()}).on("video.ended",this.playEnd.bind(this)).on(x,function(t,n){return e.handleError(n)}),this}},{key:"getSource",value:function(){return this.video.getSource()}},{key:"updateSource",value:function(e){this.video.changeSource(e)}},{key:"initialize",value:function(){var e=this.container,t=parseInt(getComputedStyle(this.target).height);return e.parentNode||(p.css(e,"height",(t||500)+"px"),this.video.init(e),this.loading.init(e),this.controls&&this.controls.init(),this.target.appendChild(e),this.initEvent()),this}}]),n}();return fe.init=function(e,t){return new fe(e,t).initialize()},fe});