!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.RPlayer=t()}(this,function(){var e={handlers:{}},t=document,l=1;function i(e){return"[object Function]"===Object.prototype.toString.call(e)}e.hasClass=function(e,t){return e.classList?e.classList.contains(t):new RegExp(t).test(e.className)},e.addClass=function(e,t){return this.hasClass(e,t)||(e.classList?e.classList.add(t):e.className+=" "+t),this},e.removeClass=function(e,t){var l=new RegExp("\\s*"+t+"\\s*");return this.hasClass(e,t)&&(e.classList?e.classList.remove(t):e.className=e.className.replace(l," ").trim()),this},e.replaceClass=function(e,t){return e.className=t,this},e.fullScreen=function(e,l){var i=this.fsApi;return i?l?t[i.exitFullscreen]():e[i.requestFullscreen]():this.fullPage(e,l),this},e.fullPage=function(t,l){l?e.removeClass(t,"fixed"):e.addClass(t,"fixed")},e.selectElement=function(e,l){var i;return l=l||t,e&&(e.nodeName?i=e:"string"==typeof e&&(/^#[^>~+\[\]\s]+$/.test(e)?(i=t.getElementById(e.substring(1)),console.log(e,i)):i=l.querySelector(e))),i},e._on=function(e,t,i){var n,o=e.guid;o||(o=l++,Object.defineProperty(e,"guid",{value:o})),(n=this.handlers[o])?n[t]||(n[t]=[]):(n=this.handlers[o]={})[t]=[],n[t].push(i),e.addEventListener(t,i)},e.on=function(e,t,l,n){var o=this.selectElement(e);return o&&i(l)?n?this._off(o,t,l):this._on(o,t,l):o&&!i(l)&&this._off(o,t),this},e._off=function(t,l,i){var n,o=t.guid,r=e.handlers[o],s=0;if(r&&(r=r[l]))if(n=r.length,i){for(;s<n;s++)if(r[s]===i){r.splice(s,1),t.removeEventListener(l,i);break}}else r.forEach(function(e){t.removeEventListener(l,e)}),e.handlers[l]=[]},e.off=function(e,t,l){return this.on(e,t,l,!0)},e.once=function(e,t,l){var n,o=this;i(l)&&(n=function(){var i=Array.prototype.slice.call(arguments);l.apply(this,i),o.off(e,t,n)},this.on(e,t,n))};e.fsApi=function(){for(var e,t,l=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=null,n=l[0],o=0,r=l.length;o<r;o++)if((e=l[o])[1]in document){t=!0;break}return t&&(i={},e.forEach(function(e,t){i[n[t]]=e})),i}();var n={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""};function o(e){var t,l,i,n,o=function(e){return e<10?"0"+e:e.toString()};return(e=Math.ceil(e))<=0?t="00:00":e<60?t="00:"+o(e):e<3600?(n=e%60,t=o(i=Math.floor(e/60))+":"+o(n)):(l=Math.floor(e/3600),t=e%3600,i=Math.floor(t/60),n=t%60,t=o(l)+":"+o(i)+":"+o(n)),t}function r(t,l){var i=e.selectElement(t);o=l,"[object Object]"===Object.prototype.toString.call(o)?this.config={autoPlay:!!l.autoPlay,defaultVolume:Math.abs(parseInt(l.defaultVolume))||n.defaultVolume,loop:!!l.loop,poster:l.poster||n.poster,source:l.source,msg:l.msg||n.msg}:this.config=n;var o;if(this.config.source,!i)throw new Error("未选中任何元素");this.target=i,this.playing=!1,this.volume=this.config.defaultVolume,this.muted=!1,this.isFullScreen=!1}var s=r.prototype;return s.toggleFullScreen=function(){(this.isFullScreen=!this.isFullScreen)?this.requestFullScreen():this.exitFullScreen()},s.requestFullScreen=function(){this.isFullScreen=!0,e.fullScreen(this.container).addClass(this.fullScreenBtn,"fullscreen").addClass(this.container,"fullscreen")},s.exitFullScreen=function(t){this.isFullScreen=!1,e.fullScreen(this.container,!0).removeClass(this.fullScreenBtn,"fullscreen").removeClass(this.container,"fullscreen")},s.initFullScreenEvent=function(){var l=this,i=e.fsApi;return i&&e.on(t,i.fullscreenchange,function(){t[i.fullscreenElement]||l.exitFullScreen()}).on(t,i.fullscreenerror,function(){l.exitFullScreen()}),e.on(this.fullScreenBtn,"click",function(){l.toggleFullScreen()}),this},s.setVolume=function(e){return e=Math.ceil(e),this.videoEl.volume=e/100,this.volume=e,this.changeVolumeStyle(e),this},s.changeVolumeStyle=function(e){var t=this.showVolumePopBtn.className;return t=t.replace(/volume-[^\s]*/,""),t+=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.volumeSlider.style.bottom=this.volumeValue.style.height=e+"%",this.showVolumePopBtn.className=this.muteBtn.className=t,this.currentVolume.innerHTML=e,this.videoEl.muted=this.muted=!e,this},s.initVolumeEvent=function(){var l,i=this;return e.on(this.showVolumePopBtn,"click",function(t){var l="rplayer-hide";e.hasClass(i.volumePopup)&&e.addClass(i.volumePopup,l),e.hasClass(i.volumePopup,l)?e.removeClass(i.volumePopup,l):e.addClass(i.volumePopup,l),t.stopPropagation()}).on(this.volumeSlider,"mousedown",function(l){if(!l.button){var n=this.offsetTop+12,o=l.clientY,r=i.volumeValue.parentNode.offsetHeight;e.on(i.container,"mousemove",function(e){var t=e.clientY,l=r-(t-o+n);l=(l=l<0?0:l>r?r:l)/r*100,i.setVolume(l)}).on(t,"mouseup",function(){e.off(i.container,"mousemove").off(t,"mouseup")})}}).on(this.volumeProgress,"click",function(e){var t=this.getBoundingClientRect(),l=e.clientY;e.target!==i.volumeSlider&&(t=(t.height-l+t.top)/t.height*100,i.setVolume(t))}).on(i.muteBtn,"click",function(){(i.muted=!i.muted)?(i.changeVolumeStyle(0),i.videoEl.mute=!0):(i.changeVolumeStyle(i.volume),i.videoEl.mute=!1)}).on(this.container,"keydown",function(t){var n=t.key.toLowerCase(),o=i.volume,r={up:5,arrowup:5,down:-5,arrowdown:-5,left:-5,arrowleft:-5,right:5,arrowright:5}[n];r&&(t.preventDefault(),o=(o+=r)>100?100:o<0?0:o,i.setVolume(o),e.hasClass(i.volumePopup,"rplayer-hide")&&(clearTimeout(l),i.volumePopupInfo.innerHTML=i.currentVolume.innerHTML=i.volume,e.removeClass(i.volumePopupInfo,"rplayer-hide"),l=setTimeout(function(){e.addClass(i.volumePopupInfo,"rplayer-hide")},3e3)))}),this.setVolume(this.config.defaultVolume),this},s.togglePlay=function(t){(this.playing=!this.playing)?(e.addClass(t,"paused"),this.videoEl.play()):(this.videoEl.pause(),e.removeClass(t,"paused"))},s.showPopupTimeInfo=function(t,l,i){if(this.videoEl.duration){var n=l.getBoundingClientRect(),r=t.clientX-n.left,s=i.offsetWidth,a=r-s/2,u=n.width-s;a=a<0?0:a>u?u:a,i.innerHTML=o(r/n.width*this.videoEl.duration),i.style.left=a+"px",e.removeClass(i,"rplayer-hide")}},s.initPlayEvent=function(){var l=this;return e.on(this.playBtn,"click",function(){l.togglePlay(this)}).on(this.videoTrack,"click",function(e){var t=this.getBoundingClientRect(),i=e.clientX;e.target!==l.videoSlider&&(t=(i-t.left)/t.width,l.videoEl.currentTime=l.videoEl.duration*t,l.videoProgress.style.width=l.videoSlider.style.left=100*t+"%")}).on(this.videoTrack,"mouseover",function(e){l.showPopupTimeInfo(e,this,l.videoPopupTime)}).on(this.videoTrack,"mousemove",function(e){l.showPopupTimeInfo(e,this,l.videoPopupTime)}).on(this.videoTrack,"mouseout",function(){e.addClass(l.videoPopupTime,"rplayer-hide")}).on(this.videoSlider,"mousedown",function(i){if(!i.button){var n,o=this.offsetLeft,r=i.clientX,s=l.videoProgress.parentNode.offsetWidth;e.on(l.container,"mousemove",function(e){var t=e.clientX;n=(n=t-r+o)<0?0:n>s?s:n,n/=s,l.videoProgress.style.width=l.videoSlider.style.left=100*n+"%",l.videoEl.pause()}).on(t,"mouseup",function(){e.off(l.container,"mousemove").off(t,"mouseup"),l.videoEl.currentTime=l.videoEl.duration*n,l.videoEl.play()})}}).on(this.videoEl,"loadedmetadata",function(){l.totalTime.innerHTML=o(this.duration)}).on(this.videoEl,"canplay",function(){e.removeClass(l.loading,"loading").addClass(l.loading,"rplayer-hide")}).on(this.videoEl,"progress",function(){var t=this.buffered,i=t.length;i&i<100&&(i=(i=t.end(i-1))/this.duration*100,l.bufferedBar.style.width=i+"%"),this.readyState<3&&e.addClass(l.loading,"loading").removeClass(l.loading,"rplayer-hide"),console.log(this.readyState)}).on(this.videoEl,"timeupdate",function(){var e=this.currentTime/this.duration*100;l.videoProgress.style.width=l.videoSlider.style.left=e+"%",l.currentTime.innerHTML=o(this.currentTime)}).on(this.videoEl,"abort",function(){l.playing&&this.play(),l.videoProgress.style.width=l.videoSlider.style.left="0"}).on(this.videoEl,"error",function(){console.log("error")}).on(this.videoEl,"seeking",function(){e.addClass(l.loading,"loading").removeClass(l.loading,"rplayer-hide")}).on(this.videoEl,"seeked",function(){e.removeClass(l.loading,"loading").addClass(l.loading,"rplayer-hide")}).on(this.videoEl,"ended",function(){l.togglePlay(l.playBtn),console.log("end")}).on(this.videoEl,"click",function(){l.togglePlay(l.playBtn)}),this},s.initEvent=function(){var l=this;return console.log(this),e.on(t,"click",function(t){var i=t.target;l.volumePopup===i||l.volumePopup.contains(i)||e.addClass(l.volumePopup,"rplayer-hide")}),this.initPlayEvent().initVolumeEvent().initFullScreenEvent()},s.destroy=function(){return this.container&&(this.target.removeChild(this.container),this.container=null),this},s.initSource=function(e){var l=this.config.source;"string"==typeof l?e.src=l:Array.isArray(l)&&l.forEach(function(l){var i=t.createElement("source");i.src=l,e.appendChild(i)})},s.initElements=function(){var t=this.container;return this.playBtn=e.selectElement(".rplayer-play-btn",t),this.videoTrack=e.selectElement(".rplayer-video-track",t),this.videoSlider=e.selectElement(".rplayer-video-slider",t),this.videoProgress=e.selectElement(".rplayer-video-progress",t),this.videoPopupTime=e.selectElement(".rplayer-video-popup-info",t),this.currentTime=e.selectElement(".rplayer-current-time",t),this.totalTime=e.selectElement(".rplayer-total-time",t),this.loading=e.selectElement(".rplayer-loading",t),this.bufferedBar=e.selectElement(".rplayer-bufferd-bar",t),this.showVolumePopBtn=e.selectElement(".rplayer-audio-btn",t),this.muteBtn=e.selectElement(".rplayer-mute",t),this.volumePopup=e.selectElement(".rplayer-volume-popup",t),this.volumePopupInfo=e.selectElement(".rplayer-popup-volume-info",t),this.volumeSlider=e.selectElement(".rplayer-volume-slider",t),this.volumeProgress=e.selectElement(".rplayer-volume-progress",t),this.volumeValue=e.selectElement(".rplayer-volume-value",t),this.currentVolume=e.selectElement(".rplayer-current-volume",t),this.fullScreenBtn=e.selectElement(".rplayer-fullscreen-btn",this.container),this},s.initialize=function(){return this.destroy(),this.container=t.createElement("div"),this.container.tabIndex=100,this.container.innerHTML='<div class="rplayer-loading rplayer-hide"></div>    <div class="rplayer-controls">        <div class="rplayer-popup-info rplayer-video-popup-info rplayer-hide">10:00</div>        <div class="rplayer-progress-panel">            <div class="rplayer-progress rplayer-video-track">                <div class="rplayer-bufferd-bar"></div>                <div class="rplayer-progress-track">                    <div class="rplayer-bar rplayer-video-progress"></div>                    <div class="rplayer-slider rplayer-video-slider"></div>                </div>            </div>        </div>        <div class="rplayer-play-control rplayer-lf">            <button type="button" class="rplayer-play-btn"></button>            <span class="rplayer-time-info">                        <span class="rplayer-current-time">00:00</span>/                        <span class="rplayer-total-time">00:00</span>                    </span>        </div>        <div class="rplayer-settings rplayer-rt">            <button type="button" class="rplayer-fullscreen-btn rplayer-rt"></button>            <div class="rplayer-audio-control rplayer-rt">                <div class="rplayer-popup-info rplayer-popup-volume-info rplayer-hide">10:00</div>                <button type="button" class="rplayer-audio-btn volume-1"></button>                <div class="rplayer-volume-popup rplayer-hide">                    <span class="rplayer-current-volume">12</span>                    <div class="rplayer-progress rplayer-volume-progress">                        <div class="rplayer-audio-track">                            <div class="rplayer-bar rplayer-volume-value"></div>                            <div class="rplayer-slider rplayer-volume-slider"></div>                        </div>                    </div>                    <button class="rplayer-mute volume-1"></button>                </div>            </div>        </div>    </div>',this.initSource(this.videoEl=t.createElement("video")),this.videoEl.appendChild(t.createTextNode(this.config.msg)),e.addClass(this.container,"rplayer-container").addClass(this.videoEl,"rplayer-video"),this.container.appendChild(this.videoEl),this.target.appendChild(this.container),this.initElements().initEvent(),this},r.init=function(e,t){return new r(e,t).initialize()},r});