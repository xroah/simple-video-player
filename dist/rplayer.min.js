!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.RPlayer=e()}(this,function(){"use strict";var t={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""},e={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},i={function:"[object Function]",object:"[object Object]",string:"[object String]",undef:"[object Undefined]"},n={up:5,arrowup:5,down:-5,arrowdown:-5,left:-10,arrowleft:-10,right:10,arrowright:10,esc:"esc",escape:"escape"," ":"space",spacebar:"space",enter:"enter"},r=document,s=function(t){return function(e){return Object.prototype.toString.call(e)===i[t]}},o=s("function"),l=s("object"),a=s("string"),h=s("undef");function u(t,e){if(arguments.length)for(var i in e){var n=e[i],r=t[i];l(n)&&l(r)?u(t[i],e[i]):t[i]=n}return t}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.isArray(t)?t.slice(e):t.length?Array.prototype.slice.call(t,e):[]}function d(t,e){if(e)try{delete t[e]}catch(t){}else for(e in t)delete t[e]}function f(t){var e=function(t){return t<10?"0"+t:t.toString()},i=void 0,n=void 0,r=void 0,s=void 0;return(t=Math.ceil(t))<=0?i="00:00":t<60?i="00:"+e(t):t<3600?(s=t%60,i=e(r=Math.floor(t/60))+":"+e(s)):(n=Math.floor(t/3600),i=t%3600,r=Math.floor(i/60),s=i%60,i=e(n)+":"+e(r)+":"+e(s)),i}var p={handlers:{}},m=1;p.hasClass=function(t,e){return!!t&&(t.classList?t.classList.contains(e):(" "+t.className+" ").indexOf(" "+e+" ")>-1)},p.addClass=function(t,e){return t&&!this.hasClass(t,e)&&(t.classList?t.classList.add(e):t.className+=" "+e),this},p.removeClass=function(t,e){var i=new RegExp("\\s+"+e+"\\s+"),n=void 0;return t&&this.hasClass(t,e)&&(n=" "+t.className+" ",t.classList?t.classList.remove(e):t.className=n.replace(i," ").trim()),this},p.toggleClass=function(t,e){var i=new RegExp("\\s+"+e+"\\s+"),n=void 0;return t&&(t.classList?t.classList.toggle(e):(e=" "+e+" ",(n=" "+t.className+" ").indexOf(e)>-1?t.className=n.replace(i," ").trim():t.className+=" "+e)),this},p.css=function(t,e,i){var n="";if(h(i)){if(l(e)){for(i in e)n+=i+":"+e[i]+";";t.style.cssText+=n}else if(a(e))return getComputedStyle(t).getPropertyValue(e)}else t.style[e]=i;return this},p.selectElement=function(t,e){var i=void 0;e=e||r,t&&(t.nodeName||(n=t,n&&n.window===n)?i=t:"string"==typeof t&&(i=/^#[^>~+\[\]\s:]+$/.test(t)?r.getElementById(t.substring(1)):e.querySelector(t)));var n;return i},p.createElement=function(t,e){var i=r.createElement(t),n=void 0;if(l(e))for(n in e)i.setAttribute(n,e[n]);return i},p._on=function(t,e,i){var n=t.guid,r=void 0;n||(n=m++,Object.defineProperty(t,"guid",{value:n})),(r=this.handlers[n])?r[e]||(r[e]=[]):(r=this.handlers[n]={})[e]=[],r[e].push(i),t.addEventListener(e,i)},p.on=function(t,e,i,n){var r=this.selectElement(t),s=void 0;if(r)if(e){if(s=(e=e.split(" ")).length,o(i))for(;s--;){var l=e[s];n?this._off(r,l,i):this._on(r,l,i)}else if(n)for(;s--;)this._off(r,e[s])}else n&&this._off(r);return this},p._off=function(t,e,i){var n=this.handlers[t.guid];if(n)if(e&&(n=n[e]))if(i){for(var r=0,s=n.length;r<s;r++)if(n[r]===i){n.splice(r,1),t.removeEventListener(e,i);break}}else n.forEach(function(i){t.removeEventListener(e,i)}),p.handlers[e]=[];else if(!e)for(var o in n)this._off(t,o)},p.off=function(t,e,i){return this.on(t,e,i,!0)},p.once=function(t,e,i){var n=void 0,r=this;return o(i)&&(n=function(){var s=Array.prototype.slice.call(arguments);i.apply(this,s),r.off(t,e,n)},this.on(t,e,n)),this};function v(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function g(){this.handlers={}}g.prototype={constructor:g,_on:function(t,e){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(e)},on:function(t,e){if(o(e)){if(!a(t))throw new TypeError("事件类型只能为String");for(var i=(t=t.split(" ")).length;i--;)this._on(t[i],e)}return this},_off:function(t,e){var i=this.handlers[t];if(i)if(o(e)){for(var n=i.length;n--;)if(e===i[n]){i.splice(n,1);break}}else h(e)&&(this.handlers[t]=[])},off:function(t,e){var i=arguments.length;if(i&&a(t))for(var n=c(arguments,1),r=(t=t.split(" ")).length;r--;){var s;(s=this._off).call.apply(s,[this,t[r]].concat(v(n)))}else i||(this.handlers={});return this},once:function(t,e){if(o(e)){var i=this;this.on(t,function n(){e.apply(this,arguments),i.off(t,n)})}},trigger:function(t){var e=c(arguments,1),i=this.handlers[t],n=void 0;if(i){(n=new function(t){this.type=t,this.data=null,this.timeStamp=0}(t)).data=e,n.timeStamp=Date.now(),e=[n].concat(e);for(var r=i.length;r--;)i[r].apply(this,e)}return this}};function y(){this.el=p.createElement("div",{class:"rplayer-loading rplayer-hide"})}y.prototype={constructor:y,show:function(){return p.removeClass(this.el,"rplayer-hide"),this},hide:function(){return p.addClass(this.el,"rplayer-hide"),this},toggle:function(){return p.toggleClass(this.el,"rplayer-hide"),this},init:function(t){return t.appendChild(this.el),this}};function E(){this.el=p.createElement("div",{class:"rplayer-error rplayer-hide"}),this.msgEl=p.createElement("div",{class:"rplayer-msg"}),this.callback=function(){}}E.prototype={constructor:E,show:function(t){return this.setMessage(t),p.removeClass(this.el,"rplayer-hide"),this},hide:function(){return p.addClass(this.el,"rplayer-hide"),this},setMessage:function(t){return this.msgEl.innerHTML=t,this},initEvent:function(){return p.on(this.msgEl,"click",this.callback),this},init:function(t,e){return this.el.appendChild(this.msgEl),t.appendChild(this.el),o(e)&&(this.callback=e),this.initEvent()}};var b=function(){for(var t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],e=null,i=t[0],n=void 0,r=void 0,s=0,o=t.length;s<o;s++)if((n=t[s])[1]in document){r=!0;break}return r&&(e={},n.forEach(function(t,n){e[i[n]]=t})),e}(),C="rplayer-fullscreen";function w(t){this.el=t,this.isFullScreen=!1,this.btn=p.createElement("button",{class:"rplayer-fullscreen-btn rplayer-rt"})}w.prototype={constructor:w,request:function(){return this.isFullScreen=!0,b?this.el[b.requestFullscreen]():this.fullPage(),p.addClass(this.el,C).addClass(this.btn,C),this},exit:function(){return this.isFullScreen=!1,b?r[b.exitFullscreen]():this.fullPage(!0),p.removeClass(this.btn,C).removeClass(this.el,C),this},toggle:function(){return this.isFullScreen=this.isFullScreen?this.exit():this.request()},fullPage:function(t){return t?p.removeClass(this.el,"rplayer-fixed"):p.addClass(this.el,"rplayer-fixed"),this},initEvent:function(){var t=this;return b&&p.on(r,b.fullscreenchange,function(){r[b.fullscreenElement]||t.exit()}).on(r,b.fullscreenerror,function(){t.exit()}),p.on(this.btn,"click",this.toggle.bind(this)),this},init:function(t,e){return this.el=t,e.appendChild(this.btn),this.initEvent()}};function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var T="video.loaded.meta",P="video.time.update",k="video.load.start",x="video.progress",F="video.volume.change";function R(t){g.call(this),this.config=t,this.playedTime=null}u(R.prototype=Object.create(g.prototype),{constructor:R,setVolume:function(t){return t>1&&(t/=100),this.el.volume=t,this.el.muted=!t,this},getVolume:function(){return Math.floor(100*this.el.volume)},mute:function(t){return this.el.muted=!!h(t)||!!t,this},isMuted:function(){return this.el.muted},autoPlay:function(t){return this.el.autoplay=!!t,this},isAutoPlay:function(){return this.el.autoplay},play:function(t){return h(t)||t?this.el.play():this.el.pause(),this},togglePlay:function(){if(this.getDuration()){var t=this.isPaused();this.play(t)}return this},isPaused:function(){return this.el.paused},isError:function(){var t=this.el.error;return t?t.code:t},loop:function(t){return this.el.loop=!!t,this},isLoop:function(){return this.el.loop},setPoster:function(t){return this.el.poster=t,this},setPreload:function(t){return this.el.preload=t,this},setCurrentTime:function(t,e){var i=this.getDuration();return e&&(t*=i),this.el.currentTime=t,this},getCurrentTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration},getPlayedPercentage:function(){return this.getCurrentTime()/this.getDuration()},getBuffered:function(t){var e=this.el.buffered,i=e.length;return t?i?e=e.end(i-1)/this.getDuration()*100:null:e},getReadyState:function(){return this.el.readyState},showControls:function(){return this.el.controls=!0,this},reload:function(){return this.el.load(),this},changeSource:function(t){var e=this.isPaused();return this.source!==t&&(this.source=t,this.initSource(t)),e||this.play(!0),this},getSource:function(){return this.el.currentSrc},initSource:function(t){var e=r.createDocumentFragment();return"string"==typeof t?this.el.src=t:Array.isArray(t)&&(this.el.innerHTML="",t.forEach(function(t){var i=p.createElement("source",{src:t});e.appendChild(i)}),this.el.appendChild(e)),this},handleError:function(){var t=this.isError(),i=void 0;switch(this.playedTime=this.getCurrentTime(),e[t]){case"MEDIA_ERR_ABORTED":i="出错了";break;case"MEDIA_ERR_NETWORK":i="网络错误或视频地址无效";break;case"MEDIA_ERR_DECODE":case"MEDIA_ERR_SRC_NOT_SUPPORTED":i="解码失败,不支持的视频格式或地址无效"}return{code:t,message:i+=",点击刷新"}},notify:function(t){var e,i=(e={},S(e,T,[{duration:this.getDuration()}]),S(e,P,[this.getCurrentTime()]),S(e,x,[this.getBuffered(!0),this.getReadyState()]),S(e,"video.error",[this.handleError()]),S(e,F,[this.isMuted()?0:this.getVolume()]),e)[t]||[];return t===k&&this.playedTime&&(this.setCurrentTime(this.playedTime),this.playedTime=0),this.trigger.apply(this,[t].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(i)))},initEvent:function(){var t=this.el;p.on(t,"loadedmetadata",this.notify.bind(this,T)).on(t,"timeupdate",this.notify.bind(this,P)).on(t,"seeking",this.notify.bind(this,"video.seeking")).on(t,"loadstart",this.notify.bind(this,k)).on(t,"progress",this.notify.bind(this,x)).on(t,"canplay seeked",this.notify.bind(this,"video.can.play")).on(t,"ended",this.notify.bind(this,"video.ended")).on(t,"error",this.notify.bind(this,"video.error")).on(t,"playing",this.notify.bind(this,"video.playing")).on(t,"pause",this.notify.bind(this,"video.pause")).on(t,"volumechange",this.notify.bind(this,F)).on(t,"dblclick",this.notify.bind(this,"video.dblclick")).on(t,"click",this.notify.bind(this,"video.click")).on(t,"contextmenu",function(t){return t.preventDefault()})},init:function(t){var e=p.createElement("video"),i=r.createTextNode(this.config.msg.toString());return this.source=this.config.source,e.appendChild(i),this.el=e,p.addClass(this.el,"rplayer-video"),t.appendChild(e),this.initSource(this.source).autoPlay(this.config.autoPlay).loop(this.config.loop).setPoster(this.config.poster).setPreload(this.config.preload).initEvent(),this},destroy:function(){p.off(this.el),this.off(),d(this)}});var M="slider.status.change";function D(t){g.call(this),this.vertical=!h(t)&&!!t,this.moveDis=this.pos=null,this.moving=!1,this.enabled=!0}var _=D.prototype=Object.create(g.prototype);_.constructor=D,_.getPosition=function(){var t=this.el.parentNode.getBoundingClientRect(),e=getComputedStyle(this.el);return{width:parseFloat(e.width),height:parseFloat(e.height),origLeft:parseFloat(e.left),origTop:parseFloat(e.top),maxX:t.width,maxY:t.height}},_.updateHPosition=function(t,e){return e&&(t=100*t+"%"),p.css(this.bar,"width",t).css(this.el,"left",t),this},_.updateVPosition=function(t,e){return e&&(t=100*t+"%"),p.css(this.bar,"height",t).css(this.el,"bottom",t),this},_.mouseDown=function(t){if(!t.button&&this.enabled){var e=t.clientX,i=t.clientY,n=this.getPosition(),s=this.getMoveCallback().bind(this);this.pos={width:n.width,height:n.height,offsetX:e-n.origLeft,offsetY:i-n.origTop,maxX:n.maxX,maxY:n.maxY},p.addClass(this.el,"rplayer-moving").on(r,"mousemove",s).on(r,"mouseup",this.mouseUp.bind(this))}},_.moveVertical=function(t,e){var i=void 0;return i=(i=this.pos.maxY-(e-this.pos.offsetY)-this.pos.height)<0?0:i>this.pos.maxY?this.pos.maxY:i,i/=this.pos.maxY,this.updateVPosition(i,!0),i},_.moveHorizontal=function(t){var e=void 0;return e=(e=t-this.pos.offsetX)<0?0:e>this.pos.maxX?this.pos.maxX:e,e/=this.pos.maxX,this.updateHPosition(e,!0),e},_.mouseMove=function(t,e){var i=t.clientX,n=t.clientY,r=e.call(this,i,n);this.moving=!0,this.trigger("slider.moving",this.moveDis=r)},_.getMoveCallback=function(){var t=this;return this.vertical?function(e){return t.mouseMove(e,t.moveVertical)}:function(e){return t.mouseMove(e,t.moveHorizontal)}},_.mouseUp=function(){var t=this;p.off(r,"mousemove moseup").removeClass(this.el,"rplayer-moving"),this.moving&&this.trigger("slider.move.done",this.moveDis),setTimeout(function(){return t.moving=!1})},_.clickTrack=function(t){if(!this.moving&&this.enabled){var e=this.track.getBoundingClientRect(),i=t.clientX,n=t.clientY,r="slider.moving";this.vertical?(e=(e.height-n+e.top)/e.height,this.updateVPosition(e,!0)):(e=(i-e.left)/e.width,r="slider.move.done",this.updateHPosition(e,!0)),this.trigger(r,e)}},_.initEvent=function(){var t=this;return p.on(this.el,"mousedown",this.mouseDown.bind(this)).on(this.track,"click",this.clickTrack.bind(this)),this.on(M,function(e,i){return t.enabled=!!i}),this},_.destroy=function(){p.off(this.track).off(this.el),d(this)},_.init=function(t){var e={track:"rplayer-video-track",bar:"rplayer-video-progress",slider:"rplayer-video-slider"};return this.vertical&&(e={track:"rplayer-volume-progress",bar:"rplayer-volume-value",slider:"rplayer-volume-slider"}),this.track=p.createElement("div",{class:"rplayer-progress "+e.track}),this.bar=p.createElement("div",{class:"rplayer-bar "+e.bar}),this.el=p.createElement("div",{class:"rplayer-slider "+e.slider}),this.track.appendChild(this.bar),this.track.append(this.el),t.appendChild(this.track),this.initEvent()};function A(t){this.panel=p.createElement("div",{class:"rplayer-volume-popup rplayer-hide"}),this.valueEl=p.createElement("div",{class:"rplayer-current-volume"}),this.muteBtn=p.createElement("button",{class:"rplayer-mute volume-1"}),this.showBtn=p.createElement("button",{class:"rplayer-audio-btn volume-1"}),this.slider=new D(!0),this.volume=t}A.prototype={constructor:A,show:function(){return p.removeClass(this.panel,"rplayer-hide"),this},hide:function(){return p.addClass(this.panel,"rplayer-hide"),this},toggle:function(t){return p.toggleClass(this.panel,"rplayer-hide"),t.stopPropagation(),this},updateVolume:function(t,e){return this.volume=t,this.media.setVolume(t),this.updateStyle(this.volume,e),this},updateVolumeByStep:function(t){var e=this.volume+t;e=e>100?100:e<0?0:e,this.updateVolume(e)},updateStyle:function(t,e){var i=this.muteBtn.className,n=this.showBtn.className,r=/volume-\S+/;return i=i.replace(r,""),n=n.replace(r,""),r=t?t<=33?"volume-1":t<=66?"volume-2":"volume-3":"volume-mute",this.muteBtn.className=i+r,this.showBtn.className=n+r,this.valueEl.innerHTML=t,!e&&this.slider.updateVPosition(t+"%"),this},mute:function(){this.media.isMuted()?(this.updateStyle(this.volume),this.media.mute(!1)):(this.updateStyle(0),this.media.mute(!0))},initEvent:function(){var t=this;return p.on(this.muteBtn,"click",this.mute.bind(this)).on(this.panel,"mouseleave",this.hide.bind(this)).on(this.showBtn,"click",this.toggle.bind(this)).on(r,"click",function(e){var i=e.target;i===t.panel||t.panel.contains(i)||t.hide()}),this.slider.on("slider.moving",function(e,i){t.updateVolume(Math.floor(100*i),!0)}),this},init:function(t,e){var i=p.createElement("div",{class:"rplayer-audio-control rplayer-rt"});return this.media=e,this.panel.appendChild(this.valueEl),this.slider.init(this.panel),this.panel.appendChild(this.muteBtn),i.appendChild(this.showBtn),i.append(this.panel),t.appendChild(i),this.updateVolume(this.volume).initEvent(),this}};function N(){this.btn=p.createElement("button",{class:"rplayer-play-btn"})}N.prototype={play:function(){return p.addClass(this.btn,"paused"),this},pause:function(){return p.removeClass(this.btn,"paused"),this},toggle:function(){return this.media.togglePlay(),this},initEvent:function(){var t=this.toggle.bind(this);return p.on(this.btn,"click",t),this.media.on("video.playing",this.play.bind(this)).on("video.pause",this.pause.bind(this)).on("video.click",t),this},init:function(t,e){return t.appendChild(this.btn),this.media=e,this.initEvent()}};function V(){this.currentEl=p.createElement("span",{class:"rplayer-current-time"}),this.totalEl=p.createElement("span",{class:"rplayer-total-time"})}V.prototype={constructor:V,updateTime:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(arguments[1]?this.totalEl:this.currentEl).innerHTML=f(t),this},initEvent:function(){var t=this;return this.media.on(P,function(e,i){return t.updateTime(i)}).on(T,function(e,i){return t.updateTime(i.duration,!0)}),this},init:function(t,e){var i=p.createElement("span",{class:"rplayer-time-info"}),n=r.createTextNode("/");return this.media=e,i.appendChild(this.currentEl),i.appendChild(n),i.appendChild(this.totalEl),t.appendChild(i),this.updateTime(0).updateTime(0,!0),this.initEvent()}};function B(t){this.el=p.createElement("div",{class:"rplayer-popup-info rplayer-hide"}),this.visible=!1,this.autoHide=!!t,this.timer=null}B.prototype={show:function(t){var e=this;return this.visible=!0,this.timer&&(clearTimeout(this.timer),this.timer=null),this.autoHide&&(this.timer=setTimeout(function(){return e.hide()},3e3)),p.removeClass(this.el,"rplayer-hide"),t&&this.updateText(t),this},hide:function(){return this.visible=!1,p.addClass(this.el,"rplayer-hide"),this},updatePosition:function(t){var e={left:"left",right:"right",top:"top",bottom:"bottom"};if(l(t))for(var i in t)e[i]&&p.css(this.el,i,t[i]);return this},updateText:function(t){return this.el.innerHTML=t,this},getSize:function(t){var e=this.visible;!e&&this.show();var i=getComputedStyle(this.el);return!e&&this.hide(),t?parseFloat(i[t]):{left:parseFloat(i.left),right:parseFloat(i.right),top:parseFloat(i.top),bottom:parseFloat(i.bottom),width:parseFloat(i.width)}},width:function(){return this.getSize("width")},height:function(){return this.getSize("height")},init:function(t,e){return e=e||"",p.addClass(this.el,e),t.appendChild(this.el),this}};function O(){this.slider=new D,this.panel=p.createElement("div",{class:"rplayer-progress-panel"}),this.bufferEl=p.createElement("div",{class:"rplayer-bufferd-bar"}),this.popup=new B,this.currentTime=this.duration=0}O.prototype={constructor:O,update:function(t){if(this.currentTime!==t){this.currentTime=t;var e=t/this.duration*100||0;this.slider.updateHPosition(e+"%")}return this},updateByStep:function(t){var e=this.currentTime,i=this.duration;return e+=t,this.currentTime=e<0?0:e>i?i:e,this.media.setCurrentTime(this.currentTime).trigger(P,this.currentTime),this},buffer:function(t){p.css(this.bufferEl,t+"%")},mouseMove:function(t){if(this.duration){this.popup.show();var e=this.panel.getBoundingClientRect(),i=t.clientX-e.left,n=this.popup.width(),r=i-n/2;n=e.width-n,r=r<0?0:r>n?n:r,n=i/e.width,this.popup.updatePosition({left:r+"px"}).updateText(f(n*this.duration))}},mouseOut:function(){this.popup.hide()},initEvent:function(){var t=this;return this.slider.on("slider.move.done",function(e,i){var n=i*t.duration;t.media.setCurrentTime(n),t.media.trigger(P,n)}),p.on(this.panel,"mouseover mousemove",this.mouseMove.bind(this)).on(this.panel,"mouseout",this.mouseOut.bind(this)),this.media.on(k,function(){return t.slider.trigger(M,!1)}).on(T,function(e,i){t.duration=i.duration,t.slider.trigger(M,!0)}).on(P,function(e,i){return t.update(i)}).on(x,function(e,i){return t.buffer(i)}),this},init:function(t,e){var i=this.panel;return this.media=e,i.appendChild(this.bufferEl),this.slider.init(i),this.popup.init(i,"rplayer-popup-video-info"),t.appendChild(i),this.initEvent()}};var L=null;function j(e,i){var n=p.selectElement(e),r=void 0;if(g.call(this),!(r=l(i)?{autoPlay:!!i.autoPlay,defaultVolume:Math.abs(parseInt(i.defaultVolume))||t.defaultVolume,loop:!!i.loop,msg:i.msg||t.msg,poster:i.poster||t.poster,preload:i.preload||t.preload,source:i.source}:t).source)throw new Error("没有设置视频链接");if(!n)throw new Error("未选中任何元素");this.target=n,this.video=new R(r),this.loading=new y,this.error=new E,this.volumeControl=new A(r.defaultVolume),this.playControl=new N,this.timeInfo=new V,this.fullScreen=new w,this.progress=new O,this.volumePopup=new B(!0),this.controls=!!h(i.controls)||!!i.controls,this.useNativeControls=!h(i.useNativeControls)&&i.useNativeControls}var I=j.prototype=Object.create(g.prototype);return I.constructor=j,I.keyDown=function(t){var e=t.key.toLowerCase(),i=n[e];i&&(/(?:left)|(?:right)/.test(e)?this.progress.updateByStep(i):/(?:up)|(?:down)/.test(e)?this.volumeControl.updateVolumeByStep(i):/esc/.test(e)?this.fullScreen.exit():/\s|(?:spacebar)/.test(e)?this.playControl.toggle():this.fullScreen.toggle()),t.preventDefault()},I.hideControls=function(){return p.addClass(this.controlsPanel,"rplayer-hide"),this},I.showControls=function(){var t=this;return this.video.isError()||(clearTimeout(L),p.removeClass(this.controlsPanel,"rplayer-hide"),L=setTimeout(function(){return t.hideControls()},5e3)),this},I.buffer=function(t,e){e<3&&this.loading.show()},I.playEnd=function(){this.trigger("play.end")},I.handleError=function(t){return this.loading.hide(),this.error.show(t.message),this},I.refresh=function(){this.video.reload(),this.error.hide()},I.initEvent=function(){var t=this;return this.video.on(k,function(){return t.loading.show()}).on("video.seeking",function(){return t.loading.show()}).on("video.can.play",function(){return t.loading.hide()}).on("video.ended",this.playEnd.bind(this)).on("video.error",function(e,i){return t.handleError(i)}),this},I.initControls=function(){var t=p.createElement("div",{class:"rplayer-settings rplayer-rt"}),e=p.createElement("div",{class:"rplayer-play-control rplayer-lf"});return this.controlsPanel=p.createElement("div",{class:"rplayer-controls"}),this.fullScreen.init(this.container,t),this.volumeControl.init(t,this.video),this.playControl.init(e,this.video),this.timeInfo.init(e,this.video),this.progress.init(this.controlsPanel,this.video),this.volumePopup.init(this.container,"rplayer-popup-volume-info"),this.controlsPanel.appendChild(t),this.controlsPanel.appendChild(e),this.container.appendChild(this.controlsPanel),this.initControlEvent()},I.showVolumePopup=function(t){var e="当前音量: "+t;return 0===t&&(e="静音"),this.volumePopup.show(e),this},I.initControlEvent=function(){var t=this;return this.video.on(x,function(e,i,n){return t.buffer(i,n)}).on(F,function(e,i,n){return t.showVolumePopup(i,n)}).on("video.dblclick",function(){return t.fullScreen.toggle()}),p.on(this.container,"keydown",this.keyDown.bind(this)).on(this.container,"mousemove",this.showControls.bind(this)),this},I.offEvent=function(){return p.off(r).off(this.container).off(this.video.el),this},I.destroy=function(){return this.container&&(this.video.destroy(),d(this),this.offEvent()),this},I.getSource=function(){return this.video.getSource()},I.updateSource=function(t){this.video.changeSource(t)},I.initialize=function(){if(!this.container){var t=p.createElement("div",{tabIndex:100}),e=parseInt(getComputedStyle(this.target).height);p.css(t,"height",(e||500)+"px"),this.container=t,this.video.init(t),this.loading.init(t),this.error.init(t,this.refresh.bind(this)),p.addClass(t,"rplayer-container"),this.controls&&!this.useNativeControls?this.initControls():this.useNativeControls&&this.video.showControls(),this.target.appendChild(t),this.initEvent()}return this},j.init=function(t,e){return new j(t,e).initialize()},j});