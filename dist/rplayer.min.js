!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.RPlayer=t()}(this,function(){"use strict";var e=document,t=1,i={autoPlay:!1,defaultVolume:50,loop:!1,poster:"",preload:"metadata",source:"",msg:""},n=null,s=null,o="rplayer-hide",r={handlers:{}};function l(e){return"[object Function]"===Object.prototype.toString.call(e)}r.hasClass=function(e,t){return e.classList?e.classList.contains(t):new RegExp(t).test(e.className)},r.addClass=function(e,t){return this.hasClass(e,t)||(e.classList?e.classList.add(t):e.className+=" "+t),this},r.removeClass=function(e,t){var i=new RegExp("\\s*"+t+"\\s*");return this.hasClass(e,t)&&(e.classList?e.classList.remove(t):e.className=e.className.replace(i," ").trim()),this},r.fullScreen=function(t,i){var n=this.fsApi;return n?i?e[n.exitFullscreen]():t[n.requestFullscreen]():this.fullPage(t,i),this},r.fullPage=function(e,t){t?r.removeClass(e,"fixed"):r.addClass(e,"fixed")},r.selectElement=function(t,i){var n;return i=i||e,t&&(t.nodeName?n=t:"string"==typeof t&&(/^#[^>~+\[\]\s]+$/.test(t)?(n=e.getElementById(t.substring(1)),console.log(t,n)):n=i.querySelector(t))),n},r._on=function(e,i,n){var s,o=e.guid;o||(o=t++,Object.defineProperty(e,"guid",{value:o})),(s=this.handlers[o])?s[i]||(s[i]=[]):(s=this.handlers[o]={})[i]=[],s[i].push(n),e.addEventListener(i,n)},r.on=function(e,t,i,n){var s,o,r=this.selectElement(e);if(r)if(s=(t=t.split(" ")).length,l(i))for(;s--;)o=t[s],n?this._off(r,o,i):this._on(r,o,i);else this._off(r,t);return this},r._off=function(e,t,i){var n,s=e.guid,o=r.handlers[s],l=0;if(o&&(o=o[t]))if(n=o.length,i){for(;l<n;l++)if(o[l]===i){o.splice(l,1),e.removeEventListener(t,i);break}}else o.forEach(function(i){e.removeEventListener(t,i)}),r.handlers[t]=[]},r.off=function(e,t,i){return this.on(e,t,i,!0)},r.once=function(e,t,i){var n,s=this;l(i)&&(n=function(){var o=Array.prototype.slice.call(arguments);i.apply(this,o),s.off(e,t,n)},this.on(e,t,n))};r.fsApi=function(){for(var e,t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=null,s=i[0],o=0,r=i.length;o<r;o++)if((e=i[o])[1]in document){t=!0;break}return t&&(n={},e.forEach(function(e,t){n[s[t]]=e})),n}();function u(e){this.config=e}u.prototype={constructor:u,setVolume:function(e){return e>=1&&(e/=100),this.el.volume=e,this.el.muted=!e,this},getVolume:function(){return Math.floor(100*this.el.volume)},mute:function(){return this.el.muted=!0,this},unMute:function(){return this.el.muted=!1,this},isMuted:function(){return this.el.muted},play:function(){return this.el.play(),this},pause:function(){return this.el.pause(),this},isPaused:function(){return this.el.paused},setCurrentTime:function(e,t){var i=this.getDuration();return t&&(e*=i),this.el.currentTime=e,this},getCurrentTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration},getPlayedPercentage:function(){return this.getCurrentTime()/this.getDuration()},getBuffered:function(){return this.el.buffered},getReadyState:function(){return this.el.readyState},convertTime:function(e){var t,i,n,s,o=function(e){return e<10?"0"+e:e.toString()};return(e=Math.ceil(e))<=0?t="00:00":e<60?t="00:"+o(e):e<3600?(s=e%60,t=o(n=Math.floor(e/60))+":"+o(s)):(i=Math.floor(e/3600),t=e%3600,n=Math.floor(t/60),s=t%60,t=o(i)+":"+o(n)+":"+o(s)),t},reload:function(){return this.el.load(),this},changeSource:function(e){var t=this.isPaused();return this.source!==e&&(this.source=e,this.initSource(),console.log(e)),t||this.play(),this},getSource:function(){return this.source},initSource:function(t){var i=e.createDocumentFragment();return"string"==typeof(t=t||this.source)?this.el.src=t:Array.isArray(t)&&(this.el.innerHTML="",t.forEach(function(t){var n=e.createElement("source");n.src=t,i.appendChild(n)}),this.el.appendChild(i)),this},init:function(){var t=e.createElement("video"),i=e.createTextNode(this.config.msg.toString());return this.el=t,this.source=this.config.source,t.appendChild(i),r.addClass(this.el,"rplayer-video"),this.initSource().setVolume(this.config.defaultVolume),this.el}};function a(e){return void 0===e}function c(e,t){var n,s=r.selectElement(e);o=t;var o;if((n="[object Object]"===Object.prototype.toString.call(o)?{autoPlay:!!t.autoPlay,defaultVolume:Math.abs(parseInt(t.defaultVolume))||i.defaultVolume,loop:!!t.loop,poster:t.poster||i.poster,source:t.source,msg:t.msg||i.msg,useBrowserControls:!a(t.useBrowserControls)&&t.useBrowserControls}:i).source||new Error("没有设置视频链接"),!s)throw new Error("未选中任何元素");this.target=s,this.isFullScreen=!1,this.video=new u(n),this.controls=!!a(t.controls)||!!t.controls}var h=c.prototype;return h.toggleFullScreen=function(){(this.isFullScreen=!this.isFullScreen)?this.requestFullScreen():this.exitFullScreen()},h.requestFullScreen=function(){this.isFullScreen=!0,r.fullScreen(this.container).addClass(this.fullScreenBtn,"fullscreen").addClass(this.container,"fullscreen")},h.exitFullScreen=function(){this.isFullScreen=!1,r.fullScreen(this.container,!0).removeClass(this.fullScreenBtn,"fullscreen").removeClass(this.container,"fullscreen")},h.initFullScreenEvent=function(){var t=this,i=r.fsApi;return i&&r.on(e,i.fullscreenchange,function(){e[i.fullscreenElement]||t.exitFullScreen()}).on(e,i.fullscreenerror,function(){t.exitFullScreen()}),r.on(this.fullScreenBtn,"click",function(){t.toggleFullScreen()}),this},h.updateVolume=function(e){return e=Math.floor(e),this.video.setVolume(e),this.updateVolumeStyle(e),this},h.updateVolumeByStep=function(e){var t=this.video.getVolume();t=(t+=e)>100?100:t<0?0:t,this.updateVolume(t),this.toggleVolumePopupInfo(t)},h.updateVolumeStyle=function(e){var t=this.showVolumePopBtn.className;return t=t.replace(/volume-[^\s]*/,""),t+=e?e<=33?"volume-1":e<=66?"volume-2":"volume-3":"volume-mute",this.volumeSlider.style.bottom=this.volumeValue.style.height=e+"%",this.showVolumePopBtn.className=this.muteBtn.className=t,this.currentVolume.innerHTML=Math.ceil(e),this},h.toggleVolumeSettingsPanel=function(e){r.hasClass(this.volumePopup,o)?this.showVolumeSettingsPanel():this.hideVolumeSettingsPanel(),e.stopPropagation()},h.showVolumeSettingsPanel=function(){return r.removeClass(this.volumePopup,o),this},h.hideVolumeSettingsPanel=function(){return r.addClass(this.volumePopup,o),this},h.slideVolumeSlider=function(t){if(!t.button){var i=this.volumeSlider.offsetTop+12,n=t.clientY,s=this.volumeSlider.parentNode.offsetHeight,o=this;r.on(e,"mousemove",function(e){var t=e.clientY,r=s-(t-n+i);r=(r=r<0?0:r>s?s:r)/s*100,o.updateVolume(r)}).on(e,"mouseup",function(){r.off(e,"mousemove").off(e,"mouseup")})}},h.initVolumeEvent=function(){var e=this;return r.on(this.showVolumePopBtn,"click",this.toggleVolumeSettingsPanel.bind(this)).on(this.volumeSlider,"mousedown",this.slideVolumeSlider.bind(this)).on(this.volumeProgress,"click",function(t){var i=this.getBoundingClientRect(),n=t.clientY;i=(i.height-n+i.top)/i.height*100,e.updateVolume(i)}).on(e.muteBtn,"click",function(){e.video.isMuted()?(e.video.unMute(),e.updateVolumeStyle(e.video.getVolume())):(e.video.mute(),e.updateVolumeStyle(0))}),this},h.togglePlay=function(){this.video.isPaused()?(this.controls&&r.addClass(this.playBtn,"paused"),this.video.play()):(this.video.pause(),this.controls&&r.removeClass(this.playBtn,"paused"))},h.showPopupTimeInfo=function(e){var t=this.video.getDuration(),i=this.videoPopupTime;if(t){r.removeClass(i,o);var n=this.videoTrack.getBoundingClientRect(),s=e.clientX-n.left,l=i.offsetWidth,u=s-l/2,a=n.width-l;u=u<0?0:u>a?a:u,i.innerHTML=this.video.convertTime(s/n.width*t),i.style.left=u+"px"}},h.hidePopupTimeInfo=function(){return r.addClass(this.videoPopupTime,o),this},h.slideVideoSlider=function(t){if(!t.button){var i,n=this.videoSlider.offsetLeft,s=t.clientX,o=this.videoSlider.parentNode.offsetWidth,l=this,u=this.video.isPaused();r.on(e,"mousemove",function(e){var t=e.clientX;i=(i=t-s+n)<0?0:i>o?o:i,i/=o,r.addClass(l.videoSlider,"moving"),l.updateProgressPosition(i),l.video.pause()}).on(e,"mouseup",function(){r.off(e,"mousemove").off(e,"mouseup"),r.removeClass(l.videoSlider,"moving"),i&&l.video.setCurrentTime(i,!0),u||l.video.play()})}},h.showLoading=function(){r.addClass(this.loading,"loading").removeClass(this.loading,o)},h.hideLoading=function(){r.removeClass(this.loading,"loading").addClass(this.loading,o)},h.progress=function(){var e=this.video.getBuffered(),t=e.length;this.controls&&t&&t<100&&(t=(t=e.end(t-1))/this.video.getDuration()*100,this.bufferedBar.style.width=t+"%"),this.video.getReadyState()<3&&this.showLoading()},h.updateProgressPosition=function(e){return a(e)&&(e=this.video.getPlayedPercentage()),this.videoProgress.style.width=this.videoSlider.style.left=100*e+"%",this.updateCurrentTime(),this},h.updateProgressByStep=function(e){var t=this.video.getCurrentTime(),i=this.video.getDuration();t=(t+=e)<0?0:t>i?i:t,this.video.setCurrentTime(t),this.updateProgressPosition().updateCurrentTime()},h.updateCurrentTime=function(){return this.currentTime.innerHTML=this.video.convertTime(this.video.getCurrentTime()),this},h.updateTotalTime=function(){return this.totalTime.innerHTML=this.video.convertTime(this.video.getDuration()),this},h.updateMetaInfo=function(){this.controls&&this.updateTotalTime()},h.initPlayEvent=function(){var e=this,t=this.video.el;return r.on(this.playBtn,"click",function(){e.togglePlay()}).on(this.videoTrack,"click",function(t){var i=this.getBoundingClientRect();i=(t.clientX-i.left)/i.width,e.video.setCurrentTime(i,!0),e.updateProgressPosition(i)}).on(t,"loadedmetadata",this.updateMetaInfo.bind(this)).on(t,"canplay seeked",this.hideLoading.bind(this)).on(t,"progress",this.progress.bind(this)).on(t,"abort",function(){}).on(t,"error",function(){console.log("error")}).on(t,"seeking",function(){e.showLoading()}).on(t,"ended",function(){e.togglePlay(),console.log("end")}).on(t,"click",this.togglePlay.bind(this)).on(t,"dblclick",this.toggleFullScreen.bind(this)).on(t,"durationchange",function(){console.log("duration changed")}),this},h.initControlsEvent=function(){var t=this;return r.on(this.videoTrack,"mouseover mousemove",this.showPopupTimeInfo.bind(this)).on(this.videoTrack,"mouseout",this.hidePopupTimeInfo.bind(this)).on(this.videoSlider,"mousedown",this.slideVideoSlider.bind(this)).on(e,"click",function(e){var i=e.target;t.volumePopup===i||t.volumePopup.contains(i)||t.hideVolumeSettingsPanel()}).on(this.container,"keydown",this.keyDown.bind(this)).on(this.container,"mousemove",function(){t.showControls()}).on(this.container,"mouseleave",function(){t.hideVolumeSettingsPanel()}).on(this.video.el,"timeupdate",this.updateProgressPosition.bind(this)),this},h.hideControls=function(){return r.addClass(this.controlsPanel,o).addClass(this.controlsPanel,"rplayer-transform"),this},h.showControls=function(){var e=this;return clearTimeout(s),r.removeClass(this.controlsPanel,o).removeClass(this.controlsPanel,"rplayer-transform"),s=setTimeout(function(){e.hideControls().hideVolumeSettingsPanel()},5e3),this},h.toggleVolumePopupInfo=function(e){var t=this;return r.hasClass(this.volumePopup,o)&&(clearTimeout(n),this.volumePopupInfo.innerHTML="当前音量: "+e,this.currentVolume.innerHTML=e,r.removeClass(this.volumePopupInfo,o),n=setTimeout(function(){r.addClass(t.volumePopupInfo,o)},3e3)),this},h.keyDown=function(e){var t=e.key.toLowerCase(),i={up:5,arrowup:5,down:-5,arrowdown:-5,left:-5,arrowleft:-5,right:5,arrowright:5,esc:"esc",escape:"escape"}[t];console.log(i),i?(/(left)|(right)/.test(t)?this.controls&&this.updateProgressByStep(i):/(up)|(down)/.test(t)?this.controls&&this.updateVolumeByStep(i):this.toggleFullScreen(),e.preventDefault()):" "!==t&&"space"!==t||(this.togglePlay(),e.preventDefault())},h.initEvent=function(){return this.initPlayEvent().initVolumeEvent().initFullScreenEvent()},h.destroy=function(){return this.container&&(this.target.removeChild(this.container),this.container=null),this},h.initEssentialElements=function(){var e=this.container;return this.loading=r.selectElement(".rplayer-loading",e),this},h.initElements=function(){var e=this.container;return this.playBtn=r.selectElement(".rplayer-play-btn",e),this.videoTrack=r.selectElement(".rplayer-video-track",e),this.videoSlider=r.selectElement(".rplayer-video-slider",e),this.videoProgress=r.selectElement(".rplayer-video-progress",e),this.videoPopupTime=r.selectElement(".rplayer-popup-video-info",e),this.currentTime=r.selectElement(".rplayer-current-time",e),this.totalTime=r.selectElement(".rplayer-total-time",e),this.bufferedBar=r.selectElement(".rplayer-bufferd-bar",e),this.showVolumePopBtn=r.selectElement(".rplayer-audio-btn",e),this.muteBtn=r.selectElement(".rplayer-mute",e),this.volumePopup=r.selectElement(".rplayer-volume-popup",e),this.volumePopupInfo=r.selectElement(".rplayer-popup-volume-info",e),this.volumeSlider=r.selectElement(".rplayer-volume-slider",e),this.volumeProgress=r.selectElement(".rplayer-volume-progress",e),this.volumeValue=r.selectElement(".rplayer-volume-value",e),this.currentVolume=r.selectElement(".rplayer-current-volume",e),this.fullScreenBtn=r.selectElement(".rplayer-fullscreen-btn",this.container),this},h.initPlayState=function(){},h.getSource=function(){return this.video.getSource()},h.initialize=function(){return this.destroy(),this.container=e.createElement("div"),this.container.tabIndex=100,this.container.innerHTML='<div class="rplayer-loading rplayer-hide"></div>    <div class="rplayer-popup-info rplayer-popup-volume-info rplayer-hide">10:00</div>',this.container.appendChild(this.video.init()),r.addClass(this.container,"rplayer-container"),this.controls&&(this.controlsPanel=e.createElement("div"),r.addClass(this.controlsPanel,"rplayer-controls").addClass(this.controlsPanel,"rplayer-hide"),this.controlsPanel.innerHTML='<div class="rplayer-popup-info rplayer-popup-video-info rplayer-hide">10:00</div>        <div class="rplayer-progress-panel">            <div class="rplayer-progress rplayer-video-track">                <div class="rplayer-bufferd-bar"></div>                <div class="rplayer-bar rplayer-video-progress"></div>                <div class="rplayer-progress-track">                    <div class="rplayer-slider rplayer-video-slider"></div>                </div>            </div>        </div>        <div class="rplayer-play-control rplayer-lf">            <button type="button" class="rplayer-play-btn"></button>            <span class="rplayer-time-info">               <span class="rplayer-current-time">00:00</span>/               <span class="rplayer-total-time">00:00</span>             </span>        </div>        <div class="rplayer-settings rplayer-rt">            <button type="button" class="rplayer-fullscreen-btn rplayer-rt"></button>            <div class="rplayer-audio-control rplayer-rt">                <button type="button" class="rplayer-audio-btn volume-1"></button>                <div class="rplayer-volume-popup rplayer-hide">                    <span class="rplayer-current-volume">12</span>                    <div class="rplayer-progress rplayer-volume-progress">                        <div class="rplayer-bar rplayer-volume-value"></div>                        <div class="rplayer-audio-track">                            <div class="rplayer-slider rplayer-volume-slider"></div>                        </div>                    </div>                    <button class="rplayer-mute volume-1"></button>                </div>            </div>        </div>',this.container.appendChild(this.controlsPanel),this.showControls().initElements().updateVolumeStyle(this.video.getVolume()).initControlsEvent()),this.target.appendChild(this.container),this.initEssentialElements().initEvent(),this},h.updateSource=function(e){this.video.changeSource(e)},c.init=function(e,t){return new c(e,t).initialize()},c});